# Vitest æ¸¬è©¦é‹è¡ŒæŒ‡å—

## ğŸš€ å¿«é€Ÿé–‹å§‹ï¼ˆæ¨è–¦ï¼‰

å¦‚æœé‡åˆ° `Error: EMFILE: too many open files` éŒ¯èª¤ï¼Œ**æœ€ç°¡å–®çš„è§£æ±ºæ–¹å¼**ï¼š

```bash
cd frontend
npm run test -- --run
```

**ç„¡éœ€ä»»ä½•ç³»çµ±è¨­å®šï¼Œç«‹å³å¯ç”¨ï¼âœ…**

---

## ğŸ“‹ å•é¡Œæè¿°

é‹è¡Œ `npm run test` æ™‚å‡ºç¾ä»¥ä¸‹éŒ¯èª¤ï¼š

```
Error: EMFILE: too many open files, watch '/home/twtrubiks/ä¸‹è¼‰/merge_meet/mergemeet/frontend/vitest.config.js'
```

## ğŸ” åŸå› åˆ†æ

é€™æ˜¯ Linux ç³»çµ±çš„ **inotify æ–‡ä»¶ç›£æ§é™åˆ¶**å•é¡Œã€‚Vitest åœ¨ watch æ¨¡å¼ä¸‹éœ€è¦ç›£æ§å¤§é‡æ–‡ä»¶å’Œç›®éŒ„ï¼Œè¶…éäº†ç³»çµ±é»˜èªé™åˆ¶ã€‚

---

## âœ… æ¨è–¦è§£æ±ºæ–¹æ¡ˆ: ä½¿ç”¨ä¸€æ¬¡æ€§é‹è¡Œæ¨¡å¼ï¼ˆç„¡éœ€ä¿®æ”¹ç³»çµ±ï¼‰

**æœ€ç°¡å–®ã€æœ€ç›´æ¥çš„æ–¹å¼ - ç„¡éœ€ä»»ä½•ç³»çµ±è¨­å®šï¼**

```bash
cd frontend
npm run test -- --run
```

### å„ªé»
- âœ… **ç„¡éœ€ä¿®æ”¹ç³»çµ±è¨­å®š**
- âœ… **ç„¡éœ€ sudo æ¬Šé™**
- âœ… é©åˆ CI/CD ç’°å¢ƒ
- âœ… é‹è¡Œé€Ÿåº¦å¿«
- âœ… æ‰€æœ‰æ¸¬è©¦çµæœå®Œæ•´é¡¯ç¤º
- âœ… è‡ªå‹•ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š

### æ¸¬è©¦çµæœ
```
Test Files  5 passed (5)
     Tests  110 passed (110)
  Duration  3.07s
```

### å…¶ä»–å¸¸ç”¨æ¸¬è©¦å‘½ä»¤

```bash
# ç”Ÿæˆè¦†è“‹ç‡å ±å‘Šï¼ˆæ¨è–¦å®šæœŸé‹è¡Œï¼‰
npm run test:coverage

# åœ–å½¢åŒ–ä»‹é¢ï¼ˆéœ€è¦ä¿®å¾© inotify é™åˆ¶ï¼‰
npm run test:ui
```

---

## ğŸ”§ é€²éšæ–¹æ¡ˆ 1: è‡¨æ™‚ä¿®å¾©ï¼ˆé‡å•Ÿå¾Œå¤±æ•ˆï¼‰

### åŸ·è¡Œå‘½ä»¤

```bash
sudo sysctl -w fs.inotify.max_user_watches=524288
sudo sysctl -w fs.inotify.max_user_instances=512
```

### âœ… åŸ·è¡Œå¾Œé©—è­‰

```bash
# é©—è­‰ max_user_watchesï¼ˆæ‡‰è©²é¡¯ç¤º 524288ï¼‰
cat /proc/sys/fs/inotify/max_user_watches

# é©—è­‰ max_user_instancesï¼ˆæ‡‰è©²é¡¯ç¤º 512ï¼‰
cat /proc/sys/fs/inotify/max_user_instances
```

### æ¸¬è©¦ Vitest Watch æ¨¡å¼

```bash
cd frontend
npm run test
```

**æ³¨æ„**: é€™å€‹è¨­å®šåœ¨**é‡å•Ÿé›»è…¦å¾Œæœƒå¤±æ•ˆ**ï¼Œéœ€è¦é‡æ–°åŸ·è¡Œã€‚

---

## ğŸ› ï¸ é€²éšæ–¹æ¡ˆ 2: æ°¸ä¹…ä¿®å¾©ï¼ˆåƒ…éœ€è¦ Watch æ¨¡å¼æ™‚ä½¿ç”¨ï¼‰

### æ­¥é©Ÿ 1: å‰µå»ºç³»çµ±é…ç½®æ–‡ä»¶

```bash
sudo tee /etc/sysctl.d/60-inotify.conf << EOF
# å¢åŠ  inotify ç›£æ§é™åˆ¶ï¼Œç”¨æ–¼ Vitest watch æ¨¡å¼
fs.inotify.max_user_watches = 524288
fs.inotify.max_user_instances = 512
EOF
```

### æ­¥é©Ÿ 2: æ‡‰ç”¨é…ç½®

```bash
sudo sysctl -p /etc/sysctl.d/60-inotify.conf
```

### æ­¥é©Ÿ 3: é©—è­‰è¨­å®š

```bash
cat /proc/sys/fs/inotify/max_user_watches
cat /proc/sys/fs/inotify/max_user_instances
```

### æ­¥é©Ÿ 4: æ¸¬è©¦

```bash
cd frontend
npm run test
```

**å„ªé»**: è¨­å®šæ°¸ä¹…ç”Ÿæ•ˆï¼Œé‡å•Ÿå¾Œä¾ç„¶æœ‰æ•ˆã€‚

**æ³¨æ„**: å¤§å¤šæ•¸æƒ…æ³ä¸‹ä½¿ç”¨**ä¸€æ¬¡æ€§é‹è¡Œæ¨¡å¼**å³å¯ï¼Œç„¡éœ€é€²è¡Œæ­¤é…ç½®ã€‚

---

## ğŸ¯ æ¨è–¦ä½¿ç”¨æ–¹å¼

### â­ æ—¥å¸¸ä½¿ç”¨ï¼ˆæ¨è–¦ï¼‰

```bash
cd frontend

# é‹è¡Œæ‰€æœ‰æ¸¬è©¦ï¼ˆæ¨è–¦ï¼‰
npm run test -- --run

# ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
npm run test:coverage
```

**èªªæ˜**: ä¸€æ¬¡æ€§é‹è¡Œæ¨¡å¼å®Œå…¨æ»¿è¶³æ—¥å¸¸é–‹ç™¼å’Œæ¸¬è©¦éœ€æ±‚ï¼Œç„¡éœ€ä¿®æ”¹ç³»çµ±è¨­å®šã€‚

### ğŸ“‹ ä¸åŒå ´æ™¯çš„å‘½ä»¤é¸æ“‡

| å ´æ™¯ | å‘½ä»¤ | èªªæ˜ |
|------|------|------|
| **æ—¥å¸¸æ¸¬è©¦** | `npm run test -- --run` | â­ æ¨è–¦ï¼Œç„¡éœ€ç³»çµ±è¨­å®š |
| **è¦†è“‹ç‡å ±å‘Š** | `npm run test:coverage` | æŸ¥çœ‹æ¸¬è©¦è¦†è“‹ç‡ |
| **CI/CD** | `npm run test -- --run` | é©åˆè‡ªå‹•åŒ–æµç¨‹ |
| **Watch æ¨¡å¼** | `npm run test` | éœ€è¦å…ˆåŸ·è¡Œé€²éšæ–¹æ¡ˆä¿®å¾© |
| **åœ–å½¢ä»‹é¢** | `npm run test:ui` | éœ€è¦å…ˆåŸ·è¡Œé€²éšæ–¹æ¡ˆä¿®å¾© |

---

## ğŸ“Š æ¸¬è©¦å‘½ä»¤å°æ¯”

| å‘½ä»¤ | éœ€è¦ç³»çµ±è¨­å®š | è‡ªå‹•ç›£è½ | æ¨è–¦åº¦ | ç”¨é€” |
|------|-------------|---------|--------|------|
| `npm run test -- --run` | âŒ ä¸éœ€è¦ | âŒ å¦ | â­â­â­ | **æ¨è–¦æ—¥å¸¸ä½¿ç”¨** |
| `npm run test:coverage` | âŒ ä¸éœ€è¦ | âŒ å¦ | â­â­â­ | ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š |
| `npm run test` | âœ… éœ€è¦ | âœ… æ˜¯ | â­ | Watch æ¨¡å¼ï¼ˆé€²éšï¼‰ |
| `npm run test:ui` | âœ… éœ€è¦ | âœ… æ˜¯ | â­ | åœ–å½¢ä»‹é¢ï¼ˆé€²éšï¼‰ |

---

## ğŸ› æ•…éšœæ’é™¤

### å•é¡Œ: é‡åˆ° "too many open files" éŒ¯èª¤

**æœ€ä½³è§£æ±ºæ–¹æ¡ˆ**: ç›´æ¥ä½¿ç”¨ä¸€æ¬¡æ€§é‹è¡Œæ¨¡å¼

```bash
cd frontend
npm run test -- --run
```

**å„ªé»**: ç„¡éœ€ä»»ä½•ç³»çµ±è¨­å®šï¼Œç«‹å³å¯ç”¨ï¼

### é€²éš: å¦‚æœéœ€è¦ Watch æ¨¡å¼

åƒè€ƒä¸Šæ–¹çš„ã€Œé€²éšæ–¹æ¡ˆ 1ã€æˆ–ã€Œé€²éšæ–¹æ¡ˆ 2ã€é€²è¡Œç³»çµ±è¨­å®šèª¿æ•´ã€‚

**æ³¨æ„**: å¤§å¤šæ•¸æƒ…æ³ä¸‹ä¸éœ€è¦ Watch æ¨¡å¼ï¼Œä¸€æ¬¡æ€§é‹è¡Œå®Œå…¨æ»¿è¶³æ¸¬è©¦éœ€æ±‚ã€‚

---

## ğŸ“š ç›¸é—œè³‡æº

- [Vitest Watch Mode æ–‡æª”](https://vitest.dev/guide/features.html#watch-mode)
- [Linux inotify æ–‡æª”](https://man7.org/linux/man-pages/man7/inotify.7.html)
- [è§£æ±º "too many open files" å•é¡Œ](https://github.com/guard/listen/wiki/Increasing-the-amount-of-inotify-watchers)

---

## âœ… ç•¶å‰æ¸¬è©¦ç‹€æ…‹

- **æ¸¬è©¦æª”æ¡ˆ**: 5 å€‹
- **æ¸¬è©¦æ•¸é‡**: 110 å€‹
- **é€šéç‡**: 100%
- **æ¨è–¦é‹è¡Œæ–¹å¼** â­:
  ```bash
  cd frontend
  npm run test -- --run          # æ—¥å¸¸æ¸¬è©¦ï¼ˆæ¨è–¦ï¼‰
  npm run test:coverage          # è¦†è“‹ç‡å ±å‘Š
  ```

---

**æ–‡æª”æ›´æ–°æ—¥æœŸ**: 2025-11-16
**Vitest ç‰ˆæœ¬**: 4.0.9
