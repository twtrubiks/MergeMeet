# 📋 MergeMeet 手動測試指南

**版本**: 1.0.0
**測試範圍**: Week 1-5 功能
**最後更新**: 2025-11-14

---

## 📖 目錄

- [1. 測試環境準備](#1-測試環境準備)
- [2. 測試帳號資訊](#2-測試帳號資訊)
- [3. 功能測試流程](#3-功能測試流程)
  - [3.1 用戶註冊與登入](#31-用戶註冊與登入)
  - [3.2 個人檔案管理](#32-個人檔案管理)
  - [3.3 探索與配對](#33-探索與配對)
  - [3.4 配對列表](#34-配對列表)
  - [3.5 即時聊天](#35-即時聊天)
  - [3.6 安全功能](#36-安全功能)
- [4. 測試檢查清單](#4-測試檢查清單)
- [5. 常見問題排查](#5-常見問題排查)

---

## 1. 測試環境準備

### 1.1 啟動開發環境

**前置條件：**
- Docker 和 Docker Compose 已安裝
- 專案已 clone 到本地

**啟動步驟：**

```bash
# 1. 進入專案目錄
cd /path/to/mergemeet

# 2. 啟動資料庫服務
docker-compose up -d postgres redis

# 3. 啟動後端（新終端視窗）
cd backend
source venv/bin/activate  # 如果有虛擬環境
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 4. 啟動前端（新終端視窗）
cd frontend
npm run dev
```

**驗證服務狀態：**
- ✅ 後端健康檢查: http://localhost:8000/health
- ✅ 後端 API 文檔: http://localhost:8000/docs
- ✅ 前端應用: http://localhost:5173

### 1.2 瀏覽器要求

**推薦瀏覽器：**
- Chrome 100+ 或 Edge 100+
- Firefox 100+
- Safari 15+

**必須啟用：**
- JavaScript
- Cookies
- Local Storage
- WebSocket 支援

### 1.3 測試前準備

在開始測試前，請開啟**瀏覽器開發者工具**（按 `F12`）：
- **Console** 標籤：查看錯誤訊息
- **Network** 標籤：監控 API 請求
- **Application** 標籤：查看 LocalStorage

---

## 2. 測試帳號資訊

### 2.1 預設測試帳號

測試時可使用以下帳號，或自行註冊新帳號：

| 帳號 | Email | 密碼 | 狀態 |
|------|-------|------|------|
| Alice | alice@example.com | Password123 | 完整檔案 |
| Bob | bob@example.com | Password123 | 完整檔案 |
| Carol | carol@example.com | Password123 | 完整檔案 |
| David | david@example.com | Password123 | 完整檔案 |

**註**:
- 密碼必須包含至少一個大寫字母（後端驗證要求）
- 如果帳號不存在，需要先自行註冊

### 2.2 測試資料範例

**個人檔案資料：**
- 顯示名稱：測試用戶A
- 性別：男性 / 女性
- 生日：1990-01-01
- 個人簡介：喜歡旅遊和美食的軟體工程師
- 地理位置：台北市信義區 (25.0330, 121.5654)

**興趣標籤：** 請選擇 3-10 個
- 旅遊、美食、運動、音樂、電影、閱讀、攝影等

---

## 3. 功能測試流程

## 3.1 用戶註冊與登入

### 測試案例 1.1: 新用戶註冊

**測試步驟：**

1. 訪問註冊頁面
   - 網址: http://localhost:5173/register

2. 填寫註冊表單
   ```
   Email: test_user_001@example.com
   密碼: TestPass123!
   確認密碼: TestPass123!
   姓名: 測試用戶001
   性別: 男性
   生日: 1995-06-15
   ```

3. 點擊「註冊」按鈕

**預期結果：**
- ✅ 表單驗證通過（無紅色錯誤提示）
- ✅ 註冊成功，自動跳轉到登入頁面或首頁
- ✅ 顯示歡迎訊息或成功提示
- ✅ Network 標籤看到 `POST /api/auth/register` 返回 `201`

**失敗情況：**
- ❌ Email 已存在 → 顯示「Email 已被註冊」
- ❌ 密碼不符合要求 → 顯示密碼規則提示
- ❌ 未滿 18 歲 → 顯示「必須年滿 18 歲」

---

### 測試案例 1.2: 用戶登入

**測試步驟：**

1. 訪問登入頁面
   - 網址: http://localhost:5173/login

2. 填寫登入表單
   ```
   Email: alice@example.com
   密碼: Password123
   ```

3. 點擊「登入」按鈕

**預期結果：**
- ✅ 登入成功，跳轉到首頁或個人檔案頁面
- ✅ 導航列顯示用戶名稱
- ✅ LocalStorage 儲存 `access_token` 和 `refresh_token`
- ✅ Network 標籤看到 `POST /api/auth/login` 返回 `200`

**驗證 Token：**
在 Console 執行：
```javascript
console.log('Access Token:', localStorage.getItem('access_token'))
console.log('Refresh Token:', localStorage.getItem('refresh_token'))
```

**失敗情況：**
- ❌ Email 或密碼錯誤 → 顯示「帳號或密碼錯誤」
- ❌ 帳號不存在 → 顯示錯誤訊息

---

### 測試案例 1.3: 登出功能

**測試步驟：**

1. 確保已登入狀態
2. 點擊導航列的「登出」按鈕

**預期結果：**
- ✅ 登出成功，跳轉到登入頁面
- ✅ LocalStorage 中的 token 被清除
- ✅ 無法訪問需要認證的頁面

---

## 3.2 個人檔案管理

### 測試案例 2.1: 建立個人檔案

**前置條件：** 已登入

**測試步驟：**

1. 訪問個人檔案頁面
   - 網址: http://localhost:5173/profile
   - 或點擊導航列的「個人檔案」

2. 如果尚未建立檔案，填寫表單
   ```
   顯示名稱: Alice
   性別: 女性
   個人簡介: 喜歡旅遊和美食的軟體工程師，熱愛探索新事物
   地理位置: 台北市信義區
   ```

3. 點擊「儲存」按鈕

**預期結果：**
- ✅ 檔案建立成功
- ✅ 顯示「檔案已建立」成功訊息
- ✅ 頁面顯示剛建立的檔案資訊
- ✅ Network 標籤看到 `POST /api/profile` 返回 `201`

---

### 測試案例 2.2: 上傳照片

**前置條件：** 已建立個人檔案

**測試步驟：**

1. 在個人檔案頁面，找到「上傳照片」區域

2. 點擊「選擇照片」或拖曳照片到上傳區域
   - 準備 1-6 張照片（JPG/PNG，每張 < 5MB）

3. 選擇照片後，點擊「上傳」

**預期結果：**
- ✅ 照片上傳成功
- ✅ 照片顯示在個人檔案中
- ✅ 第一張照片自動設為主頭像
- ✅ Network 標籤看到 `POST /api/profile/photos` 返回 `201`
- ✅ 檔案完整度指示器更新

**限制測試：**
- 上傳第 7 張照片 → 應顯示「最多只能上傳 6 張照片」
- 上傳非圖片檔案 → 應顯示「只能上傳圖片檔案」

---

### 測試案例 2.3: 設定興趣標籤

**前置條件：** 已建立個人檔案

**測試步驟：**

1. 在個人檔案頁面，找到「興趣標籤」區域

2. 點擊「編輯興趣」按鈕

3. 從興趣清單中選擇 **3-10 個**標籤
   - 例如：旅遊、美食、運動、音樂、電影

4. 點擊「儲存」按鈕

**預期結果：**
- ✅ 興趣標籤更新成功
- ✅ 選擇的標籤顯示在個人檔案中
- ✅ Network 標籤看到 `PUT /api/profile/interests` 返回 `200`
- ✅ 檔案完整度指示器更新

**邊界測試：**
- 選擇少於 3 個 → 應顯示「至少選擇 3 個興趣」
- 選擇超過 10 個 → 應顯示「最多選擇 10 個興趣」

---

### 測試案例 2.4: 檔案完整度檢查

**測試步驟：**

1. 檢查個人檔案頁面的「檔案完整度」指示器

**完整檔案的條件：**
- ✅ 已填寫顯示名稱
- ✅ 已選擇性別
- ✅ 已填寫個人簡介
- ✅ 已上傳至少 1 張照片
- ✅ 已選擇 3-10 個興趣標籤

**預期結果：**
- ✅ 符合條件時顯示「檔案完整」或 100% 進度
- ✅ 不完整時顯示缺少哪些項目
- ✅ `is_complete` 狀態正確（可在 API 回應中查看）

---

### 測試案例 2.5: 編輯個人檔案

**測試步驟：**

1. 在個人檔案頁面，點擊「編輯」按鈕

2. 修改以下欄位：
   ```
   顯示名稱: Alice Updated
   個人簡介: 更新後的個人簡介
   年齡偏好: 25-35 歲
   距離偏好: 50 公里
   ```

3. 點擊「儲存」按鈕

**預期結果：**
- ✅ 更新成功
- ✅ 頁面顯示更新後的資訊
- ✅ Network 標籤看到 `PATCH /api/profile` 返回 `200`

---

### 測試案例 2.6: 刪除照片

**測試步驟：**

1. 在個人檔案頁面，找到已上傳的照片

2. 點擊照片上的「刪除」按鈕（通常是 × 圖示）

3. 確認刪除

**預期結果：**
- ✅ 照片刪除成功
- ✅ 照片從頁面消失
- ✅ 如果刪除主頭像，第一張照片自動成為新主頭像
- ✅ Network 標籤看到 `DELETE /api/profile/photos/{photo_id}` 返回 `204`

---

## 3.3 探索與配對

### 測試案例 3.1: 瀏覽候選人

**前置條件：**
- 已登入
- 個人檔案已完整

**測試步驟：**

1. 訪問探索頁面
   - 網址: http://localhost:5173/discovery
   - 或點擊導航列的「探索」

2. 觀察顯示的候選人卡片

**預期結果：**
- ✅ 顯示符合偏好的候選人
- ✅ 卡片顯示：照片、姓名、年齡、簡介、興趣標籤、距離
- ✅ 候選人符合以下條件：
  - 性別符合偏好
  - 年齡在偏好範圍內
  - 距離在設定範圍內
  - 雙方都有完整檔案
- ✅ Network 標籤看到 `GET /api/discovery/browse` 返回 `200`

**無候選人情況：**
- 如果沒有符合條件的用戶，應顯示「目前沒有符合條件的用戶」

---

### 測試案例 3.2: 喜歡（Like）候選人

**測試步驟：**

1. 在探索頁面，對候選人執行以下操作之一：
   - 點擊「❤️」（愛心）按鈕
   - 向右滑動卡片

2. 觀察反應

**預期結果：**
- ✅ 卡片向右滑出並消失
- ✅ 顯示下一位候選人
- ✅ Network 標籤看到 `POST /api/discovery/like/{user_id}` 返回 `200` 或 `201`

**配對成功情況：**
- 如果對方也喜歡你，應該：
  - ✅ 顯示「配對成功！」彈窗或動畫
  - ✅ 顯示配對對象資訊
  - ✅ 提供「開始聊天」按鈕

---

### 測試案例 3.3: 跳過（Pass）候選人

**測試步驟：**

1. 在探索頁面，對候選人執行以下操作之一：
   - 點擊「✖️」（叉叉）按鈕
   - 向左滑動卡片

2. 觀察反應

**預期結果：**
- ✅ 卡片向左滑出並消失
- ✅ 顯示下一位候選人
- ✅ Network 標籤看到 `POST /api/discovery/pass/{user_id}` 返回 `200`

**24 小時限制：**
- 同一候選人在 24 小時內不應再次出現

---

### 測試案例 3.4: 檢視配對列表

**前置條件：** 至少有 1 個配對

**測試步驟：**

1. 點擊導航列的「配對」或訪問
   - 網址: http://localhost:5173/matches

2. 觀察配對列表

**預期結果：**
- ✅ 顯示所有配對的用戶
- ✅ 每個配對顯示：頭像、姓名、配對時間
- ✅ 按配對時間排序（最新的在前）
- ✅ Network 標籤看到 `GET /api/discovery/matches` 返回 `200`

**互動測試：**
- ✅ 點擊配對卡片 → 跳轉到聊天頁面
- ✅ 如果沒有配對 → 顯示「目前沒有配對」

---

## 3.4 配對列表

### 測試案例 4.1: 查看對話列表

**前置條件：** 至少有 1 個配對

**測試步驟：**

1. 訪問配對頁面
   - 網址: http://localhost:5173/matches

2. 檢查對話列表內容

**預期結果：**
- ✅ 顯示所有活躍配對
- ✅ 每個對話顯示：
  - 對方頭像
  - 對方姓名
  - 最後一條訊息預覽
  - 未讀訊息數量（如果有）
  - 最後訊息時間
- ✅ 按最後訊息時間排序
- ✅ Network 標籤看到 `GET /api/messages/conversations` 返回 `200`

**載入狀態測試：**
- ✅ 首次載入時顯示 loading 動畫
- ✅ 載入完成後顯示對話列表
- ✅ **重要**: 不應該一直卡在 loading 狀態

---

## 3.5 即時聊天

### 測試案例 5.1: 進入聊天室

**前置條件：** 至少有 1 個配對

**測試步驟：**

1. 從配對列表點擊一個配對

2. 進入聊天頁面

**預期結果：**
- ✅ 跳轉到聊天頁面 `/chat/{match_id}`
- ✅ 顯示對方姓名和頭像
- ✅ WebSocket 連接成功（Console 應顯示 "WebSocket connected"）
- ✅ 載入歷史訊息
- ✅ 顯示訊息輸入框
- ✅ Network 標籤看到：
  - `GET /api/messages/matches/{match_id}/messages` 返回 `200`
  - WebSocket 連接到 `ws://localhost:8000/ws`

---

### 測試案例 5.2: 發送文字訊息

**測試步驟：**

1. 在聊天頁面的訊息輸入框輸入文字
   ```
   嗨！很高興認識你 😊
   ```

2. 按 Enter 或點擊「發送」按鈕

**預期結果：**
- ✅ 訊息立即顯示在聊天視窗（自己的訊息在右側）
- ✅ 訊息包含：內容、時間戳記
- ✅ 輸入框清空
- ✅ WebSocket 發送訊息（可在 Network > WS 標籤查看）
- ✅ 訊息狀態從「發送中」變為「已發送」

---

### 測試案例 5.3: 接收訊息

**前置條件：** 需要另一個瀏覽器視窗或無痕模式登入另一個測試帳號

**測試步驟：**

1. **視窗 A**: 用 Alice 登入並進入與 Bob 的聊天室

2. **視窗 B**: 用 Bob 登入並進入與 Alice 的聊天室

3. **視窗 B**: Bob 發送訊息
   ```
   嗨 Alice！我也很高興認識你
   ```

4. **視窗 A**: 觀察 Alice 的聊天視窗

**預期結果：**
- ✅ Alice 的視窗**即時**收到 Bob 的訊息（不需重新整理）
- ✅ 訊息顯示在左側（對方訊息）
- ✅ 顯示訊息內容和時間
- ✅ Console 顯示 WebSocket 收到新訊息事件

---

### 測試案例 5.4: 訊息已讀狀態

**測試步驟：**

1. 使用兩個瀏覽器視窗（Alice 和 Bob）

2. Bob 發送訊息給 Alice

3. Alice 打開聊天室並查看訊息

**預期結果：**
- ✅ Bob 的視窗顯示訊息為「已讀」（✓✓ 或藍色勾勾）
- ✅ 已讀時間顯示
- ✅ Network 標籤看到 `POST /api/messages/messages/read` 返回 `204`

---

### 測試案例 5.5: 打字指示器

**測試步驟：**

1. 使用兩個瀏覽器視窗（Alice 和 Bob）

2. Alice 在輸入框開始打字

3. 觀察 Bob 的聊天視窗

**預期結果：**
- ✅ Bob 的視窗顯示「Alice 正在輸入...」
- ✅ Alice 停止打字 3 秒後，指示器消失

---

### 測試案例 5.6: 聊天記錄捲動載入

**前置條件：** 聊天記錄超過 50 條訊息

**測試步驟：**

1. 進入有大量訊息的聊天室

2. 捲動到訊息列表頂部

**預期結果：**
- ✅ 首次載入顯示最新 50 條訊息
- ✅ 捲動到頂部時自動載入更早的訊息
- ✅ 顯示 loading 指示器
- ✅ Network 標籤看到分頁請求 `page=2, page=3...`

---

### 測試案例 5.7: 刪除訊息

**測試步驟：**

1. 在聊天室中，找到**自己發送的**訊息

2. 長按或右鍵點擊訊息

3. 選擇「刪除訊息」

4. 確認刪除

**預期結果：**
- ✅ 訊息從聊天室消失
- ✅ 顯示「訊息已刪除」或訊息變成刪除狀態
- ✅ Network 標籤看到 `DELETE /api/messages/messages/{message_id}` 返回 `204`

**限制測試：**
- ❌ 嘗試刪除對方的訊息 → 應該無法操作或顯示錯誤

---

## 3.6 安全功能

### 測試案例 6.1: 封鎖用戶

**測試步驟：**

1. 在探索頁面或配對列表，找到要封鎖的用戶

2. 點擊用戶卡片的「封鎖」按鈕（通常是 🚫 圖示）

3. 確認封鎖操作

**預期結果：**
- ✅ 封鎖成功，顯示確認訊息
- ✅ 該用戶從探索列表消失
- ✅ 如果有配對，配對狀態變為 BLOCKED
- ✅ 無法再看到該用戶的訊息
- ✅ Network 標籤看到 `POST /api/safety/block/{user_id}` 返回 `201`

---

### 測試案例 6.2: 查看封鎖列表

**測試步驟：**

1. 訪問封鎖列表頁面
   - 網址: http://localhost:5173/blocked
   - 或從設定頁面進入

2. 查看封鎖的用戶列表

**預期結果：**
- ✅ 顯示所有已封鎖的用戶
- ✅ 每個用戶顯示：姓名、頭像、封鎖時間
- ✅ Network 標籤看到 `GET /api/safety/blocked` 返回 `200`

---

### 測試案例 6.3: 解除封鎖

**測試步驟：**

1. 在封鎖列表頁面

2. 點擊「解除封鎖」按鈕

3. 確認操作

**預期結果：**
- ✅ 解除封鎖成功
- ✅ 用戶從封鎖列表移除
- ✅ 可以再次在探索中看到該用戶
- ✅ Network 標籤看到 `DELETE /api/safety/block/{user_id}` 返回 `204`

---

### 測試案例 6.4: 舉報用戶

**測試步驟：**

1. 在探索頁面或配對列表，點擊「舉報」按鈕（通常是 🚨 圖示）

2. 填寫舉報表單：
   ```
   舉報類型: 不當內容 (INAPPROPRIATE)
   舉報原因: 個人檔案包含不適當的照片
   證據（選填）: 截圖或詳細描述
   ```

3. 點擊「提交舉報」

**預期結果：**
- ✅ 舉報成功，顯示確認訊息
- ✅ 舉報表單關閉
- ✅ Network 標籤看到 `POST /api/safety/report` 返回 `201`

**舉報類型：**
- INAPPROPRIATE - 不當內容
- HARASSMENT - 騷擾行為
- FAKE_PROFILE - 假帳號
- SCAM - 詐騙
- OTHER - 其他

---

## 4. 測試檢查清單

### ✅ 用戶認證（Week 1）
- [ ] 新用戶註冊成功
- [ ] 用戶登入成功
- [ ] Token 正確儲存在 LocalStorage
- [ ] 登出功能正常
- [ ] 錯誤訊息正確顯示

### ✅ 個人檔案（Week 2）
- [ ] 建立個人檔案
- [ ] 上傳 1-6 張照片
- [ ] 設定 3-10 個興趣標籤
- [ ] 編輯個人檔案
- [ ] 刪除照片
- [ ] 檔案完整度檢查正確

### ✅ 探索與配對（Week 3）
- [ ] 瀏覽候選人（符合偏好）
- [ ] Like 候選人
- [ ] Pass 候選人
- [ ] 配對成功提示
- [ ] 查看配對列表

### ✅ 即時聊天（Week 4）
- [ ] WebSocket 連接成功
- [ ] 發送訊息
- [ ] 即時接收訊息
- [ ] 訊息已讀狀態
- [ ] 打字指示器
- [ ] 聊天記錄載入
- [ ] 刪除訊息

### ✅ 安全功能（Week 5）
- [ ] 封鎖用戶
- [ ] 查看封鎖列表
- [ ] 解除封鎖
- [ ] 舉報用戶（5 種類型）

### ✅ 效能與穩定性
- [ ] 頁面載入時間 < 2 秒
- [ ] API 回應時間 < 500ms
- [ ] 無 JavaScript 錯誤（Console 無紅色錯誤）
- [ ] 無 307 重定向錯誤
- [ ] WebSocket 穩定連接

---

## 5. 常見問題排查

### 問題 1: 配對列表一直轉圈圈

**症狀：** 訪問 `/matches` 頁面時持續顯示 loading

**排查步驟：**

1. 開啟開發者工具 > Console 標籤
   - 查看是否有紅色錯誤訊息

2. 切換到 Network 標籤
   - 找到 `/api/discovery/matches` 請求
   - 檢查 Status Code:
     - `200` ✅ 正常
     - `401` ❌ Token 失效，需重新登入
     - `307` ❌ URL 格式錯誤

3. 檢查 Token
   ```javascript
   console.log(localStorage.getItem('access_token'))
   ```
   - 如果是 `null`，需重新登入

**解決方案：**
- 重新登入
- 清除 LocalStorage: `localStorage.clear()`

---

### 問題 2: WebSocket 無法連接

**症狀：** 聊天室無法即時收發訊息

**排查步驟：**

1. Console 查看 WebSocket 狀態
   - 應該看到 "WebSocket connected"
   - 如果看到 "WebSocket connection failed"，繼續檢查

2. Network > WS 標籤
   - 檢查是否有 WebSocket 連接
   - Status 應該是 `101 Switching Protocols`

3. 確認後端 WebSocket 服務運行
   ```bash
   curl http://localhost:8000/health
   ```

**解決方案：**
- 確認後端服務正常運行
- 檢查防火牆設定
- 重新整理頁面

---

### 問題 3: 圖片無法上傳

**症狀：** 上傳照片失敗

**可能原因：**
- 檔案過大（超過 5MB）
- 檔案格式不支援（只支援 JPG/PNG）
- 已達到 6 張照片上限

**解決方案：**
- 壓縮圖片
- 轉換圖片格式
- 先刪除舊照片

---

### 問題 4: 收不到訊息

**症狀：** 對方發送訊息，但看不到

**排查步驟：**

1. 確認 WebSocket 連接狀態（見問題 2）

2. 檢查是否在正確的聊天室
   - URL 應該是 `/chat/{正確的match_id}`

3. 嘗試重新整理頁面

**解決方案：**
- 重新連接 WebSocket
- 重新整理頁面
- 確認對方未被封鎖

---

### 問題 5: 307 重定向錯誤

**症狀：** Network 標籤看到 307 Temporary Redirect

**原因：** API URL 尾隨斜線格式錯誤

**確認：**
檢查 Network 請求的 URL，不應該有尾隨斜線：
- ✅ 正確: `/api/profile`
- ❌ 錯誤: `/api/profile/`

**解決方案：**
- 清除瀏覽器快取
- 確認使用最新版本的前端代碼

---

### 問題 6: Token 失效（401 錯誤）

**症狀：** API 請求返回 401 Unauthorized

**解決方案：**
1. 重新登入
2. 或嘗試刷新 Token（如果實作了 refresh 功能）

---

## 📝 測試報告模板

測試完成後，請填寫以下報告：

```
測試報告
========

測試日期: ________
測試人員: ________
測試環境:
- 瀏覽器: ________
- 作業系統: ________

測試結果統計:
- 總測試案例數: __
- 通過: __
- 失敗: __
- 阻塞: __

失敗案例詳情:
1. 案例編號: ____
   失敗原因: ____
   重現步驟: ____
   截圖: ____

其他發現:
-

建議:
-
```

---

## 📞 支援資訊

**遇到問題？**
- 查看 [CLAUDE.md](../../CLAUDE.md) - 開發指南
- 查看 [MATCHES_DEBUG_GUIDE.md](../archived/bug-fixes/MATCHES_DEBUG_GUIDE.md) - 配對問題診斷
- 查看 [TESTING_GUIDE.md](./TESTING_GUIDE.md) - 自動化測試指南

**技術支援：**
- 開發團隊 Slack 頻道
- GitHub Issues

---

**祝測試順利！** 🎉
