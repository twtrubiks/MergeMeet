# MergeMeet ç®¡ç†å“¡è¨­ç½®æŒ‡å—

## ğŸ“‹ ç›®éŒ„
1. [ç®¡ç†å“¡å¸³è™Ÿå‰µå»º](#ç®¡ç†å“¡å¸³è™Ÿå‰µå»º)
2. [å¯†ç¢¼è¨­ç½®æµç¨‹](#å¯†ç¢¼è¨­ç½®æµç¨‹)
3. [ç®¡ç†å“¡æ¬Šé™èªªæ˜](#ç®¡ç†å“¡æ¬Šé™èªªæ˜)
4. [å®‰å…¨æœ€ä½³å¯¦è¸](#å®‰å…¨æœ€ä½³å¯¦è¸)
5. [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ)

---

## ç®¡ç†å“¡å¸³è™Ÿå‰µå»º

### æ–¹æ³•ä¸€ï¼šé€éè³‡æ–™åº«ç›´æ¥å‰µå»ºï¼ˆæ¨è–¦ç”¨æ–¼åˆå§‹åŒ–ï¼‰

```bash
# 1. é€²å…¥ backend ç›®éŒ„
cd backend

# 2. ä½¿ç”¨ Python ç”Ÿæˆå¯†ç¢¼å“ˆå¸Œ
python3 -c "
import sys
sys.path.insert(0, '.')
from app.core.security import get_password_hash

password = 'your_secure_password_here'  # æ›¿æ›ç‚ºä½ çš„å¼·å¯†ç¢¼
hashed = get_password_hash(password)
print(f'Password hash: {hashed}')
"

# 3. å°‡å“ˆå¸Œå¯†ç¢¼æ’å…¥è³‡æ–™åº«
docker exec mergemeet_postgres psql -U mergemeet -d mergemeet -c "
INSERT INTO users (id, email, password_hash, date_of_birth, is_admin, email_verified, is_active)
VALUES (
    gen_random_uuid(),
    'admin@yourdomain.com',  -- æ›¿æ›ç‚ºç®¡ç†å“¡ email
    '\$2b\$12\$xxxxx...',     -- æ›¿æ›ç‚ºä¸Šé¢ç”Ÿæˆçš„å“ˆå¸Œ
    '1990-01-01',            -- ç®¡ç†å“¡ç”Ÿæ—¥ï¼ˆ18+ é©—è­‰ï¼‰
    true,                    -- è¨­ç½®ç‚ºç®¡ç†å“¡
    true,                    -- Email å·²é©—è­‰
    true                     -- å¸³è™Ÿå•Ÿç”¨
);
"
```

### æ–¹æ³•äºŒï¼šé€éè¨»å†Š API + è³‡æ–™åº«æ›´æ–°

```bash
# 1. ä½¿ç”¨ä¸€èˆ¬è¨»å†Šæµç¨‹å‰µå»ºå¸³è™Ÿ
curl -X POST http://localhost:8000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@yourdomain.com",
    "password": "SecurePassword123!",
    "date_of_birth": "1990-01-01"
  }'

# 2. å°‡è©²å¸³è™Ÿæå‡ç‚ºç®¡ç†å“¡
docker exec mergemeet_postgres psql -U mergemeet -d mergemeet -c "
UPDATE users
SET is_admin = true, email_verified = true
WHERE email = 'admin@yourdomain.com';
"
```

---

## å¯†ç¢¼è¨­ç½®æµç¨‹

### å¯†ç¢¼è¦æ±‚
- **æœ€å°é•·åº¦**: 8 å­—å…ƒ
- **å»ºè­°é•·åº¦**: 12+ å­—å…ƒ
- **è¤‡é›œåº¦**: åŒ…å«å¤§å°å¯«å­—æ¯ã€æ•¸å­—ã€ç‰¹æ®Šå­—å…ƒ
- **ç¦æ­¢**: å¸¸è¦‹å¯†ç¢¼ã€å€‹äººè³‡è¨Šã€é€£çºŒå­—å…ƒ

### å¯†ç¢¼å“ˆå¸Œæ©Ÿåˆ¶
MergeMeet ä½¿ç”¨é›™é‡å“ˆå¸Œä¿è­·å¯†ç¢¼ï¼š
1. **SHA256 é è™•ç†**: é¿å… bcrypt 72 bytes é™åˆ¶
2. **bcrypt åŠ å¯†**: é˜²æ­¢å½©è™¹è¡¨æ”»æ“Š

```python
# å¯†ç¢¼è™•ç†æµç¨‹ï¼ˆapp/core/security.pyï¼‰
def get_password_hash(password: str) -> str:
    # 1. SHA256 é è™•ç†
    pre_hashed = hashlib.sha256(password.encode('utf-8')).hexdigest()
    # 2. bcrypt åŠ å¯†
    return pwd_context.hash(pre_hashed)
```

### é‡ç½®ç®¡ç†å“¡å¯†ç¢¼

**æ­¥é©Ÿ 1: ç”Ÿæˆæ–°å¯†ç¢¼å“ˆå¸Œ**
```bash
cd backend
python3 -c "
import sys
sys.path.insert(0, '.')
from app.core.security import get_password_hash

new_password = 'NewSecurePassword123!'
print('New password hash:', get_password_hash(new_password))
"
```

**æ­¥é©Ÿ 2: æ›´æ–°è³‡æ–™åº«**
```bash
docker exec mergemeet_postgres psql -U mergemeet -d mergemeet -c "
UPDATE users
SET password_hash = '\$2b\$12\$xxxxx...'  -- æ›¿æ›ç‚ºæ–°çš„å“ˆå¸Œ
WHERE email = 'admin@mergemeet.com';
"
```

**æ­¥é©Ÿ 3: é©—è­‰ç™»å…¥**
```bash
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@mergemeet.com",
    "password": "NewSecurePassword123!"
  }'
```

---

## ç®¡ç†å“¡æ¬Šé™èªªæ˜

### å¯åŸ·è¡Œæ“ä½œ
âœ… **å…§å®¹å¯©æ ¸**
- æŸ¥çœ‹æ‰€æœ‰èˆ‰å ±
- å¯©æ ¸èˆ‰å ±ä¸¦æ¡å–è¡Œå‹•
- ç®¡ç†ç”³è¨´

âœ… **ç”¨æˆ¶ç®¡ç†**
- å°ç¦/è§£ç¦ç”¨æˆ¶
- è¨­ç½®å°ç¦æœŸé™
- æŸ¥çœ‹ç”¨æˆ¶è©³æƒ…

âœ… **æ•æ„Ÿè©ç®¡ç†**
- æ–°å¢/ç·¨è¼¯/åˆªé™¤æ•æ„Ÿè©
- è¨­ç½®éæ¿¾ç´šåˆ¥ï¼ˆè­¦å‘Š/æ‹’çµ•/è‡ªå‹•å°ç¦ï¼‰
- é…ç½®æ­£å‰‡è¡¨é”å¼è¦å‰‡

âœ… **æ•¸æ“šçµ±è¨ˆ**
- ç³»çµ±ä½¿ç”¨çµ±è¨ˆ
- ç”¨æˆ¶æ´»èºåº¦åˆ†æ
- èˆ‰å ±è¶¨å‹¢ç›£æ§

### å—é™æ“ä½œ
âŒ **ä¸å¯åŸ·è¡Œ**
- ç„¡æ³•å°ç¦å…¶ä»–ç®¡ç†å“¡
- ç„¡æ³•ç›´æ¥æŸ¥çœ‹ç”¨æˆ¶ç§å¯†è¨Šæ¯ï¼ˆéœ€é€éèˆ‰å ±æ©Ÿåˆ¶ï¼‰
- ç„¡æ³•ç¹éç³»çµ±å¯©è¨ˆæ—¥èªŒ

---

## å®‰å…¨æœ€ä½³å¯¦è¸

### 1. å¯†ç¢¼ç®¡ç†
```
âœ… ä½¿ç”¨å¯†ç¢¼ç®¡ç†å™¨ç”Ÿæˆå¼·å¯†ç¢¼
âœ… å®šæœŸæ›´æ›å¯†ç¢¼ï¼ˆå»ºè­° 90 å¤©ï¼‰
âœ… ä¸åŒç³»çµ±ä½¿ç”¨ä¸åŒå¯†ç¢¼
âœ… å•Ÿç”¨é›™å› ç´ èªè­‰ï¼ˆå¦‚å·²å¯¦ä½œï¼‰
âŒ ä¸åœ¨ä»£ç¢¼æˆ–é…ç½®æ–‡ä»¶ä¸­ç¡¬ç·¨ç¢¼å¯†ç¢¼
âŒ ä¸é€éä¸å®‰å…¨é€šé“åˆ†äº«å¯†ç¢¼
```

### 2. å¸³è™Ÿä¿è­·
```bash
# æª¢æŸ¥ç®¡ç†å“¡å¸³è™Ÿ
docker exec mergemeet_postgres psql -U mergemeet -d mergemeet -c "
SELECT email, is_admin, is_active, created_at, updated_at
FROM users
WHERE is_admin = true;
"

# åœç”¨é–’ç½®ç®¡ç†å“¡å¸³è™Ÿ
docker exec mergemeet_postgres psql -U mergemeet -d mergemeet -c "
UPDATE users
SET is_active = false
WHERE email = 'old.admin@example.com';
"
```

### 3. å¯©è¨ˆæ—¥èªŒ
```bash
# æŸ¥çœ‹ç®¡ç†å“¡æ“ä½œè¨˜éŒ„ï¼ˆéœ€å¯¦ä½œå¯©è¨ˆæ—¥èªŒåŠŸèƒ½ï¼‰
# TODO: å¯¦ä½œç®¡ç†å“¡æ“ä½œå¯©è¨ˆæ—¥èªŒ
```

### 4. IP ç™½åå–®ï¼ˆç”Ÿç”¢ç’°å¢ƒå»ºè­°ï¼‰
```python
# config.py - é™åˆ¶ç®¡ç†å¾Œå°è¨ªå• IP
ADMIN_ALLOWED_IPS = [
    "192.168.1.0/24",  # å…§ç¶²
    "1.2.3.4"          # ç‰¹å®š IP
]
```

---

## å¸¸è¦‹å•é¡Œ

### Q1: å¿˜è¨˜ç®¡ç†å“¡å¯†ç¢¼æ€éº¼è¾¦ï¼Ÿ
**A:** æŒ‰ç…§[é‡ç½®ç®¡ç†å“¡å¯†ç¢¼](#é‡ç½®ç®¡ç†å“¡å¯†ç¢¼)æµç¨‹æ“ä½œã€‚

### Q2: å¦‚ä½•æŸ¥çœ‹ç›®å‰æœ‰å“ªäº›ç®¡ç†å“¡ï¼Ÿ
```bash
docker exec mergemeet_postgres psql -U mergemeet -d mergemeet -c "
SELECT email, is_admin, is_active, created_at
FROM users
WHERE is_admin = true;
"
```

### Q3: å¯ä»¥æœ‰å¤šå€‹ç®¡ç†å“¡å—ï¼Ÿ
**A:** å¯ä»¥ï¼Œä½†å»ºè­°ï¼š
- ç”Ÿç”¢ç’°å¢ƒï¼š2-3 å€‹ç®¡ç†å“¡å¸³è™Ÿ
- æ¯å€‹ç®¡ç†å“¡ä½¿ç”¨ç¨ç«‹å¸³è™Ÿï¼ˆå¯è¿½è¹¤æ“ä½œï¼‰
- å®šæœŸå¯©æŸ¥ç®¡ç†å“¡åå–®

### Q4: å¦‚ä½•æ’¤éŠ·ç®¡ç†å“¡æ¬Šé™ï¼Ÿ
```bash
docker exec mergemeet_postgres psql -U mergemeet -d mergemeet -c "
UPDATE users
SET is_admin = false
WHERE email = 'former.admin@example.com';
"
```

### Q5: ç®¡ç†å“¡å¯†ç¢¼æœ‰ç‰¹æ®Šè¦æ±‚å—ï¼Ÿ
**A:**
- æœ€å°é•·åº¦ï¼š8 å­—å…ƒ
- **å¼·çƒˆå»ºè­°**ï¼š12+ å­—å…ƒ + å¤§å°å¯«å­—æ¯ + æ•¸å­— + ç‰¹æ®Šå­—å…ƒ
- **ç¦æ­¢**ï¼špasswordã€adminã€123456 ç­‰å¸¸è¦‹å¯†ç¢¼

### Q6: æ¸¬è©¦ç’°å¢ƒçš„é è¨­ç®¡ç†å“¡å¸³è™Ÿï¼Ÿ
```
Email: admin@mergemeet.com
å¯†ç¢¼: admin123 (æ¸¬è©¦ç”¨ï¼Œç”Ÿç”¢ç’°å¢ƒå‹™å¿…æ›´æ”¹ï¼)
```

---

## å¿«é€Ÿåƒè€ƒ

### å‰µå»ºç®¡ç†å“¡ï¼ˆå®Œæ•´æµç¨‹ï¼‰
```bash
# 1. ç”Ÿæˆå¯†ç¢¼å“ˆå¸Œ
cd backend
HASH=$(python3 -c "
import sys
sys.path.insert(0, '.')
from app.core.security import get_password_hash
print(get_password_hash('YourSecurePassword123!'))
")

# 2. æ’å…¥è³‡æ–™åº«
docker exec mergemeet_postgres psql -U mergemeet -d mergemeet <<EOF
INSERT INTO users (id, email, password_hash, date_of_birth, is_admin, email_verified, is_active)
VALUES (
    gen_random_uuid(),
    'admin@yourdomain.com',
    '$HASH',
    '1990-01-01',
    true,
    true,
    true
);
EOF

# 3. é©—è­‰ç™»å…¥
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@yourdomain.com","password":"YourSecurePassword123!"}'
```

### æ¸¬è©¦ç™»å…¥
```bash
# Web UI
http://localhost:5173/admin/login

# API æ¸¬è©¦
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@mergemeet.com","password":"admin123"}'
```

---

## ç›¸é—œæ–‡æª”
- [API æ–‡æª”](http://localhost:8000/docs) - FastAPI Swagger UI
- [è³‡æ–™åº« Schema](../backend/app/models/user.py)
- [å®‰å…¨é…ç½®](../backend/app/core/security.py)

---

**æ–‡æª”ç‰ˆæœ¬**: v1.0
**æœ€å¾Œæ›´æ–°**: 2025-12-13
**ç¶­è­·è€…**: MergeMeet Development Team
