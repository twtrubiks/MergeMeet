# ğŸ—ï¸ MergeMeet æ¶æ§‹æ–‡æª”

## ğŸ“‹ æ–‡æª”ç›®çš„

æœ¬æ–‡æª”æ•´åˆå°ˆæ¡ˆçš„æ ¸å¿ƒæ¶æ§‹è¨­è¨ˆã€æŠ€è¡“é¸å‹ã€é–‹ç™¼ç­–ç•¥èˆ‡å¯¦ä½œé€²åº¦ï¼Œä½œç‚ºé–‹ç™¼åœ˜éšŠçš„æŠ€è¡“åƒè€ƒæŒ‡å—ã€‚

---

## 1. å°ˆæ¡ˆæ¦‚è¿°

### 1.1 å°ˆæ¡ˆå®šç¾©

```yaml
å°ˆæ¡ˆåç¨±: MergeMeet
å°ˆæ¡ˆé¡å‹: Web-based Dating Platform (ç¶²é ç‰ˆäº¤å‹å¹³å°)
ç›®æ¨™å¸‚å ´: å°ç£ï¼ˆåˆæœŸï¼‰
ç›®æ¨™ç”¨æˆ¶: 18æ­²ä»¥ä¸Šæˆå¹´äºº
é–‹ç™¼éšæ®µ: MVP (Minimum Viable Product)
ç•¶å‰ç‹€æ…‹: Week 1-6 å·²å®Œæˆ
```

### 1.2 å°ˆæ¡ˆç›®æ¨™

**ä¸»è¦ç›®æ¨™ï¼š**
- æä¾›å®‰å…¨ã€æœ‰è¶£çš„ç·šä¸Šäº¤å‹é«”é©—
- é€éèˆˆè¶£å’Œåœ°ç†ä½ç½®å¹«åŠ©ç”¨æˆ¶æ‰¾åˆ°åˆé©å°è±¡
- å»ºç«‹åŸºæ–¼é…å°çš„å³æ™‚èŠå¤©å¹³å°

**æŠ€è¡“ç›®æ¨™ï¼š**
- âœ… å»ºç«‹å¯æ“´å±•çš„æŠ€è¡“æ¶æ§‹
- âœ… é”åˆ° 80% ä»¥ä¸Šæ¸¬è©¦è¦†è“‹ç‡ï¼ˆå·²é”æˆï¼‰

---

## 2. ç³»çµ±æ¶æ§‹

### 2.1 æ•´é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ¶ç«¯ (Browser)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Vue.js 3 Frontend                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Views   â”‚  â”‚  Pinia   â”‚  â”‚  WebSocket   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚Componentsâ”‚  â”‚  Stores  â”‚  â”‚    Client    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  (17å€‹)  â”‚  â”‚  (7å€‹)   â”‚  â”‚ (Composable) â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTPS / WSS
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FastAPI Backend                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API Routes  â”‚  â”‚  Services   â”‚  â”‚  WebSocket   â”‚  â”‚
â”‚  â”‚  (10å€‹æ¨¡çµ„)   â”‚  â”‚  (9å€‹æœå‹™)  â”‚  â”‚   Manager    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                  â”‚                 â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                    â–¼                                     â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚            â”‚  SQLAlchemy  â”‚                             â”‚
â”‚            â”‚   2.0 Async  â”‚                             â”‚
â”‚            â”‚     ORM      â”‚                             â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL   â”‚          â”‚    Redis     â”‚
â”‚   17 + PostGISâ”‚          â”‚      8.x     â”‚
â”‚               â”‚          â”‚              â”‚
â”‚  - Users      â”‚          â”‚  - Cache     â”‚
â”‚  - Profiles   â”‚          â”‚  - Sessions  â”‚
â”‚  - Matches    â”‚          â”‚  - ç™»å…¥é™åˆ¶  â”‚
â”‚  - Messages   â”‚          â”‚              â”‚
â”‚  - Reports    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€è¡“æ£§è©³ç´°èªªæ˜

#### å¾Œç«¯æŠ€è¡“æ£§

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” | ç‹€æ…‹ |
|------|------|------|------|
| **Python** | 3.12+ | ä¸»è¦é–‹ç™¼èªè¨€ | âœ… |
| **FastAPI** | 0.109+ | Web æ¡†æ¶ | âœ… |
| **SQLAlchemy** | 2.0 | ORMï¼ˆAsyncï¼‰ | âœ… |
| **PostgreSQL** | 17 | ä¸»è³‡æ–™åº« | âœ… |
| **PostGIS** | 3.5+ | åœ°ç†ä½ç½®æŸ¥è©¢ | âœ… |
| **Redis** | 8.x | å¿«å–/Session/ç™»å…¥é™åˆ¶ | ğŸ”„ éƒ¨åˆ†ä½¿ç”¨ |
| **Pydantic** | 2.5+ | è³‡æ–™é©—è­‰ | âœ… |
| **JWT** | python-jose | èªè­‰æ©Ÿåˆ¶ | âœ… |
| **aiosmtplib** | 3.0+ | Email ç™¼é€æœå‹™ | âœ… |
| **Mailpit** | latest | Email æ¸¬è©¦å·¥å…·ï¼ˆé–‹ç™¼ï¼‰ | âœ… |
| **Alembic** | 1.13+ | è³‡æ–™åº«é·ç§» | âœ… |
| **pytest** | 7.4+ | æ¸¬è©¦æ¡†æ¶ | âœ… |

#### å‰ç«¯æŠ€è¡“æ£§

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” | ç‹€æ…‹ |
|------|------|------|------|
| **Vue.js** | 3.x | å‰ç«¯æ¡†æ¶ | âœ… |
| **Vite** | 5.x | å»ºæ§‹å·¥å…· | âœ… |
| **Pinia** | 2.x | ç‹€æ…‹ç®¡ç† | âœ… |
| **Vue Router** | 4.x | è·¯ç”±ç®¡ç† | âœ… |
| **Axios** | 1.x | HTTP å®¢æˆ¶ç«¯ | âœ… |
| **WebSocket API** | åŸç”Ÿ | å³æ™‚é€šè¨Š | âœ… |

### 2.3 è³‡æ–™åº«æ¶æ§‹

#### è³‡æ–™æ¨¡å‹é—œä¿‚åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚ (ç”¨æˆ¶åŸºæœ¬è³‡æ–™)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚
â”‚ email       â”‚â—„â”€â”€â”€â”€â”€â”€â”
â”‚ password    â”‚       â”‚
â”‚ trust_score â”‚       â”‚ 1:1
â”‚ warning_cnt â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                      â”‚
                â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                â”‚  Profile   â”‚ (å€‹äººæª”æ¡ˆ)
                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                â”‚ id (PK)    â”‚
                â”‚ user_id    â”‚
                â”‚ bio        â”‚
                â”‚ location   â”‚ (PostGIS Point)
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ 1:N                   â”‚ N:M
          â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Photo    â”‚ (ç…§ç‰‡)  â”‚ InterestTag â”‚ (èˆˆè¶£æ¨™ç±¤)
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id (PK)    â”‚         â”‚ id (PK)     â”‚
    â”‚ profile_id â”‚         â”‚ name        â”‚
    â”‚ file_path  â”‚         â”‚ category    â”‚
    â”‚ is_primary â”‚         â”‚ icon        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ is_active   â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Like     â”‚  â”‚    Pass     â”‚  â”‚    Match    â”‚ (é…å°è¨˜éŒ„)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚  â”‚ id (PK)     â”‚  â”‚ id (PK)     â”‚
â”‚ liker_id    â”‚  â”‚ passer_id   â”‚  â”‚ user1_id    â”‚
â”‚ liked_id    â”‚  â”‚ passed_id   â”‚  â”‚ user2_id    â”‚
â”‚ created_at  â”‚  â”‚ passed_at   â”‚  â”‚ status      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ matched_at  â”‚
       â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 äº’ç›¸å–œæ­¡æ™‚å»ºç«‹ Match
                            â”‚ 1:N
                            â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   Message   â”‚ (èŠå¤©è¨Šæ¯)
                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                      â”‚ id (PK)     â”‚
                      â”‚ match_id    â”‚
                      â”‚ sender_id   â”‚
                      â”‚ content     â”‚
                      â”‚ is_read     â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BlockedUser  â”‚      â”‚   Report    â”‚ (èˆ‰å ±è¨˜éŒ„)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚      â”‚ id (PK)     â”‚
â”‚ blocker_id   â”‚      â”‚ reporter_id â”‚
â”‚ blocked_id   â”‚      â”‚ reported_id â”‚
â”‚ reason       â”‚      â”‚ report_type â”‚
â”‚ created_at   â”‚      â”‚ reason      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ status      â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Notification â”‚ (é€šçŸ¥è¨˜éŒ„ - æŒä¹…åŒ–)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚
â”‚ user_id      â”‚
â”‚ type         â”‚ (message/match/liked)
â”‚ title        â”‚
â”‚ content      â”‚
â”‚ data (JSONB) â”‚
â”‚ is_read      â”‚
â”‚ created_at   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SensitiveWord â”‚     â”‚ ContentAppeal â”‚     â”‚ ModerationLog â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)       â”‚     â”‚ id (PK)       â”‚     â”‚ id (PK)       â”‚
â”‚ word          â”‚     â”‚ user_id       â”‚     â”‚ user_id       â”‚
â”‚ category      â”‚     â”‚ content_type  â”‚     â”‚ action        â”‚
â”‚ severity      â”‚     â”‚ content_id    â”‚     â”‚ reason        â”‚
â”‚ is_active     â”‚     â”‚ reason        â”‚     â”‚ details       â”‚
â”‚ created_at    â”‚     â”‚ status        â”‚     â”‚ admin_id      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ admin_notes   â”‚     â”‚ created_at    â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 PostGIS åœ°ç†ä½ç½®æŸ¥è©¢

#### ç‚ºä»€éº¼ä½¿ç”¨ PostGIS

MergeMeet ä½œç‚ºäº¤å‹å¹³å°ï¼Œ**åœ°ç†ä½ç½®æœç´¢æ˜¯æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ç”¨æˆ¶éœ€è¦æ‰¾åˆ°ã€Œé™„è¿‘çš„äººã€
- é…å°ç®—æ³•éœ€è¦è¨ˆç®—ç”¨æˆ¶é–“çš„å¯¦éš›è·é›¢
- è·é›¢æ˜¯é…å°è©•åˆ†çš„é‡è¦å› ç´ ï¼ˆä½” 20%ï¼‰

**æŠ€è¡“é¸å‹ç†ç”±**ï¼š

| æ–¹æ¡ˆ | å„ªé» | ç¼ºé» | çµè«– |
|------|------|------|------|
| **PostGIS** | ç²¾ç¢ºçƒé¢è¨ˆç®—ã€åŸç”Ÿ SQL æ”¯æ´ã€é«˜æ•ˆç©ºé–“ç´¢å¼• | éœ€è¦é¡å¤–æ“´å±• | âœ… æ¡ç”¨ |
| æ‡‰ç”¨å±¤è¨ˆç®— | ç°¡å–® | æ•ˆèƒ½å·®ã€ç„¡æ³•åˆ©ç”¨ç´¢å¼• | âŒ |
| Elasticsearch Geo | å…¨æ–‡æœç´¢æ•´åˆ | é¡å¤–ç¶­è­·æˆæœ¬ | âŒ |

#### Docker æ˜ åƒé¸æ“‡

```yaml
# docker-compose.yml
services:
  postgres:
    image: postgis/postgis:17-3.5
```

**ç‰ˆæœ¬èªªæ˜**ï¼š
- **PostgreSQL 17**ï¼š2024-09 ç™¼å¸ƒï¼Œæ•ˆèƒ½å„ªåŒ–ã€JSON_TABLE æ”¯æ´
- **PostGIS 3.5**ï¼š2024 å¹´ç™¼å¸ƒï¼Œæ”¯æ´æœ€æ–°ç©ºé–“å‡½æ•¸
- **å®˜æ–¹æ˜ åƒ**ï¼šç”± PostGIS åœ˜éšŠç¶­è­·ï¼Œé å…ˆå®‰è£æ“´å±•

#### è³‡æ–™é¡å‹é¸æ“‡

```python
# backend/app/models/profile.py
from geoalchemy2 import Geography

class Profile(Base):
    # ä½¿ç”¨ Geography é¡å‹ï¼ˆè€Œé Geometryï¼‰
    location = Column(Geography(geometry_type='POINT', srid=4326))
```

**Geography vs Geometry**ï¼š

| ç‰¹æ€§ | Geography | Geometry |
|------|-----------|----------|
| åº§æ¨™ç³»çµ± | çƒé¢ï¼ˆåœ°çƒè¡¨é¢ï¼‰ | å¹³é¢ï¼ˆç¬›å¡çˆ¾ï¼‰ |
| è·é›¢è¨ˆç®— | å…¬å°ºï¼ˆç²¾ç¢ºï¼‰ | åº§æ¨™å–®ä½ï¼ˆéœ€è½‰æ›ï¼‰ |
| é©ç”¨ç¯„åœ | å…¨çƒ | å°å€åŸŸï¼ˆåŸå¸‚ç´šï¼‰ |
| æ•ˆèƒ½ | ç¨æ…¢ | è¼ƒå¿« |
| **æœ¬å°ˆæ¡ˆé¸æ“‡** | âœ… æ¡ç”¨ | - |

**é¸æ“‡ Geography çš„åŸå› **ï¼š
- äº¤å‹å¹³å°ç”¨æˆ¶åˆ†å¸ƒå…¨å°ç£ï¼Œéœ€è¦ç²¾ç¢ºçš„çƒé¢è·é›¢
- `ST_Distance` ç›´æ¥è¿”å›å…¬å°ºï¼Œç„¡éœ€é¡å¤–è½‰æ›
- æœªä¾†æ“´å±•åˆ°å…¶ä»–åœ‹å®¶æ™‚ç„¡éœ€ä¿®æ”¹

#### ä½¿ç”¨çš„ PostGIS å‡½æ•¸

| å‡½æ•¸ | ç”¨é€” | ä½¿ç”¨ä½ç½® |
|------|------|----------|
| `ST_MakePoint(lng, lat)` | å¾ç¶“ç·¯åº¦å‰µå»ºé» | å‰µå»º/æ›´æ–°å€‹äººæª”æ¡ˆ |
| `ST_SetSRID(..., 4326)` | è¨­å®šåº§æ¨™ç³»çµ± | å‰µå»º/æ›´æ–°å€‹äººæª”æ¡ˆ |
| `ST_Distance(a, b, true)` | è¨ˆç®—çƒé¢è·é›¢ï¼ˆå…¬å°ºï¼‰ | é…å°ç®—æ³•è·é›¢è©•åˆ† |
| `ST_DWithin(a, b, dist, true)` | ç¯„åœå…§ç¯©é¸ | æ¢ç´¢åŠŸèƒ½è·é›¢éæ¿¾ |

**ä»£ç¢¼ç¯„ä¾‹**ï¼š

```python
# 1. å‰µå»ºä½ç½®é»ï¼ˆcreate_profile å‡½æ•¸ï¼‰
from geoalchemy2.functions import ST_MakePoint, ST_SetSRID

profile.location = ST_SetSRID(
    ST_MakePoint(longitude, latitude),  # æ³¨æ„ï¼šç¶“åº¦åœ¨å‰
    4326
)

# 2. è¨ˆç®—è·é›¢ï¼ˆget_discovery_candidates å‡½æ•¸ï¼‰
from sqlalchemy import func

distance_km = (
    func.ST_Distance(
        Profile.location,
        my_profile.location,
        True  # use_spheroid=True
    ) / 1000
).label('distance_km')

# 3. ç¯„åœç¯©é¸ï¼ˆget_discovery_candidates å‡½æ•¸ï¼‰
from geoalchemy2.functions import ST_DWithin

ST_DWithin(
    Profile.location,
    my_profile.location,
    max_distance_km * 1000,  # å…¬é‡Œè½‰å…¬å°º
    True
)
```

#### æ•ˆèƒ½å„ªåŒ–

- ä½¿ç”¨ `ST_DWithin` è€Œé `ST_Distance < X`ï¼ˆå¯åˆ©ç”¨ GIST ç´¢å¼•ï¼‰
- è·é›¢è¨ˆç®—ä½œç‚º SELECT æ¬„ä½ï¼Œé¿å…äºŒæ¬¡æŸ¥è©¢
- `selectinload` é è¼‰å…¥é—œè¯è³‡æ–™

#### ORM æ•´åˆï¼ˆGeoAlchemy2ï¼‰

```txt
# backend/requirements.txt
geoalchemy2==0.14.3
```

**GeoAlchemy2 åŠŸèƒ½**ï¼š
- SQLAlchemy 2.0 Async æ”¯æ´
- è‡ªå‹•é¡å‹è½‰æ›ï¼ˆWKB â†” Pythonï¼‰
- PostGIS å‡½æ•¸æ˜ å°„ï¼ˆ`ST_*` â†’ Python å‡½æ•¸ï¼‰

#### æ¸¬è©¦é…ç½®

```python
# backend/tests/conftest.py
async with engine.begin() as conn:
    # æ¸¬è©¦è³‡æ–™åº«éœ€è¦å•Ÿç”¨ PostGIS æ“´å±•
    await conn.execute(text("CREATE EXTENSION IF NOT EXISTS postgis"))
```

#### å¸¸è¦‹å•é¡Œæ’é™¤

**éŒ¯èª¤ 1**ï¼š`function st_distance does not exist`
```bash
# è§£æ±ºæ–¹æ¡ˆï¼šå•Ÿç”¨ PostGIS æ“´å±•
docker exec mergemeet_postgres psql -U mergemeet -d mergemeet \
  -c "CREATE EXTENSION IF NOT EXISTS postgis;"
```

**éŒ¯èª¤ 2**ï¼šè·é›¢è¨ˆç®—çµæœç‚º `None`
```python
# åŸå› ï¼šç”¨æˆ¶æœªè¨­å®šä½ç½®
# è§£æ±ºï¼šæª¢æŸ¥ location æ˜¯å¦ç‚ºç©º
if profile.location is None:
    distance_km = None
```

#### ç›¸é—œæ–‡ä»¶

| æ–‡ä»¶ | èªªæ˜ |
|------|------|
| `backend/app/models/profile.py` | Profile æ¨¡å‹å®šç¾©ï¼ˆlocation æ¬„ä½ï¼‰ |
| `backend/app/api/profile.py` | ä½ç½®è¨­å®š API |
| `backend/app/api/discovery.py` | è·é›¢æœç´¢é‚è¼¯ |
| `docs/MATCHING_ALGORITHM.md` | é…å°ç®—æ³•ï¼ˆè·é›¢è©•åˆ†ï¼‰ |

---

## 3. åŠŸèƒ½èˆ‡è·¯ç·šåœ–

> åŠŸèƒ½æ¸…å–®å’Œé–‹ç™¼è·¯ç·šåœ–å·²ç¨ç«‹ç¶­è­·ï¼Œé¿å…é‡è¤‡ï¼š

| æ–‡æª” | èªªæ˜ |
|------|------|
| **[FEATURES.md](FEATURES.md)** | å·²å®ŒæˆåŠŸèƒ½æ¸…å–®ï¼ˆWeek 1-6 è©³ç´°èªªæ˜ï¼‰ |
| **[ROADMAP.md](ROADMAP.md)** | æŠ€è¡“è·¯ç·šåœ–ï¼ˆæœªä¾†é–‹ç™¼è¦åŠƒï¼‰ |

---

## 4. é–‹ç™¼ç­–ç•¥

### 4.1 æ¸¬è©¦ç­–ç•¥

å°ˆæ¡ˆé‡è¦–æ¸¬è©¦è¦†è“‹ç‡ï¼Œæ¡ç”¨ã€ŒåŠŸèƒ½é–‹ç™¼ + æ¸¬è©¦é©—è­‰ã€æ¨¡å¼ï¼š

- é–‹ç™¼åŠŸèƒ½å¾Œç·¨å¯«å°æ‡‰æ¸¬è©¦
- ç¶­æŒ >80% æ¸¬è©¦è¦†è“‹ç‡
- é‡æ§‹å‰ç¢ºä¿æ¸¬è©¦é€šé

### 4.2 Commit è¦ç¯„

æ¡ç”¨ Conventional Commits æ ¼å¼ï¼š

- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¾© Bug
- `docs`: æ–‡æª”æ›´æ–°
- `refactor`: é‡æ§‹
- `style`: ç¨‹å¼ç¢¼æ ¼å¼

### 4.3 ç¨‹å¼ç¢¼è¦ç¯„

> è©³è¦‹ Skillsï¼š**backend-dev-fastapi**ã€**frontend-dev-vue3**

---

## 5. API ç«¯é»

> å®Œæ•´ API æ–‡æª”è«‹åƒé–±ï¼šhttp://localhost:8000/docs

---

## 6. å‰ç«¯æ¶æ§‹

| ç›®éŒ„ | èªªæ˜ |
|------|------|
| `src/views/` | é é¢çµ„ä»¶ |
| `src/components/` | å…±ç”¨çµ„ä»¶ |
| `src/stores/` | Pinia ç‹€æ…‹ç®¡ç† |
| `src/composables/` | Vue Composables |
| `src/api/` | API å®¢æˆ¶ç«¯ |
| `src/router/` | è·¯ç”±é…ç½® |

---

## 7. æ¸¬è©¦æ¶æ§‹

### 7.1 æ¸¬è©¦çµ±è¨ˆ

```
å¾Œç«¯æ¸¬è©¦ï¼ˆ22 å€‹æ¸¬è©¦æª”æ¡ˆï¼‰ï¼š
â”œâ”€â”€ test_auth.py - èªè­‰åŠŸèƒ½æ¸¬è©¦
â”œâ”€â”€ test_login_limiter.py - ç™»å…¥é™åˆ¶æ¸¬è©¦
â”œâ”€â”€ test_profile.py - å€‹äººæª”æ¡ˆæ¸¬è©¦
â”œâ”€â”€ test_photo_order.py - ç…§ç‰‡é †åºæ¸¬è©¦
â”œâ”€â”€ test_discovery.py - æ¢ç´¢é…å°æ¸¬è©¦
â”œâ”€â”€ test_messages.py - è¨Šæ¯æ¸¬è©¦
â”œâ”€â”€ test_websocket.py - WebSocket æ¸¬è©¦
â”œâ”€â”€ test_safety.py - å®‰å…¨åŠŸèƒ½æ¸¬è©¦
â”œâ”€â”€ test_content_moderation.py - å…§å®¹å¯©æ ¸æ¸¬è©¦
â”œâ”€â”€ test_notifications.py - é€šçŸ¥æ¸¬è©¦
â”œâ”€â”€ test_notification_persistence.py - é€šçŸ¥æŒä¹…åŒ–æ¸¬è©¦
â”œâ”€â”€ test_trust_score.py - ä¿¡ä»»åˆ†æ•¸æ¸¬è©¦
â”œâ”€â”€ test_photo_moderation.py - ç…§ç‰‡å¯©æ ¸æœå‹™æ¸¬è©¦
â”œâ”€â”€ test_photo_moderation_api.py - ç…§ç‰‡å¯©æ ¸ API æ¸¬è©¦
â”œâ”€â”€ test_moderation_api.py - å¯©æ ¸ API æ¸¬è©¦
â”œâ”€â”€ test_token_blacklist.py - Token é»‘åå–®æ¸¬è©¦
â”œâ”€â”€ test_verification_code.py - é©—è­‰ç¢¼æ¸¬è©¦
â”œâ”€â”€ test_cookie_auth.py - Cookie èªè­‰æ¸¬è©¦
â”œâ”€â”€ test_chat_image.py - èŠå¤©åœ–ç‰‡æ¸¬è©¦
â”œâ”€â”€ test_file_storage.py - æª”æ¡ˆå„²å­˜æ¸¬è©¦
â”œâ”€â”€ test_redis_integration.py - Redis æ•´åˆæ¸¬è©¦
â””â”€â”€ test_main.py - ä¸»ç¨‹å¼æ¸¬è©¦

ç¸½è¨ˆ: 351 å€‹æ¸¬è©¦æ¡ˆä¾‹
è¦†è“‹ç‡: >80%
```

### 7.2 æ¸¬è©¦å·¥å…·

```python
# pytest é…ç½®
[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
asyncio_mode = "auto"

# æ¸¬è©¦å‘½ä»¤
pytest -v                    # è©³ç´°è¼¸å‡º
pytest --cov=app            # æ¸¬è©¦è¦†è“‹ç‡
pytest tests/test_safety.py # ç‰¹å®šæª”æ¡ˆ
pytest -m unit              # ç‰¹å®šæ¨™è¨˜
```

---

## 8. å®‰å…¨æªæ–½

> è©³ç´°å®‰å…¨ç­–ç•¥è«‹åƒè€ƒ **[SECURITY.md](SECURITY.md)**

**å·²å¯¦ä½œçš„å®‰å…¨æ©Ÿåˆ¶ï¼š**
- HttpOnly Cookie + CSRF é˜²è­·
- JWT èªè­‰ï¼ˆAccess + Refresh Tokenï¼‰
- å¯†ç¢¼é›œæ¹Šï¼ˆbcrypt + SHA256 é è™•ç†ï¼‰
- SQL æ³¨å…¥é˜²è­·ï¼ˆSQLAlchemy ORMï¼‰
- XSS é˜²è­·ï¼ˆè¼¸å…¥é©—è­‰ + è¼¸å‡ºç·¨ç¢¼ï¼‰
- WebSocket Token é©—è­‰ + ç•°å¸¸é€£æ¥æ¸…ç†
- ç™»å…¥å¤±æ•—é™åˆ¶ï¼ˆRedisï¼Œ5 æ¬¡/15 åˆ†é˜ï¼‰
- ä¿¡ä»»åˆ†æ•¸ç³»çµ±ï¼ˆè‡ªå‹•è¡Œç‚ºç›£æ§ï¼‰
- å…§å®¹å¯©æ ¸ç³»çµ±ï¼ˆæ•æ„Ÿè©éæ¿¾ï¼‰

---

## 9. é—œéµæ±ºç­–è¨˜éŒ„

### 9.1 æŠ€è¡“é¸å‹

**é¸æ“‡ FastAPIï¼ˆè€Œé Djangoï¼‰ï¼š**
- âœ… åŸç”Ÿæ”¯æ´ Async/Await
- âœ… è‡ªå‹•ç”Ÿæˆ API æ–‡æª”
- âœ… å„ªç§€çš„æ•ˆèƒ½è¡¨ç¾
- âœ… ç¾ä»£åŒ–çš„é–‹ç™¼é«”é©—

**é¸æ“‡ Vue 3ï¼ˆè€Œé Reactï¼‰ï¼š**
- âœ… Composition API æ›´ç›´è¦º
- âœ… è¼•é‡ç´šæ¡†æ¶
- âœ… å„ªç§€çš„ä¸­æ–‡æ–‡æª”
- âœ… å­¸ç¿’æ›²ç·šè¼ƒå¹³ç·©

**é¸æ“‡ PostgreSQL + PostGISï¼š**
- âœ… å¼·å¤§çš„åœ°ç†ä½ç½®æŸ¥è©¢
- âœ… JSONB æ”¯æ´
- âœ… å®Œå–„çš„é—œè¯å¼è³‡æ–™åº«
- âœ… å…è²»é–‹æº

### 9.2 æ¶æ§‹æ±ºç­–

**æ¡ç”¨å‰å¾Œç«¯åˆ†é›¢ï¼š**
- âœ… å‰å¾Œç«¯ç¨ç«‹é–‹ç™¼
- âœ… æ›´å¥½çš„å¯æ“´å±•æ€§
- âœ… æ”¯æ´å¤šç«¯ï¼ˆWebã€Mobileï¼‰

**ä½¿ç”¨ WebSocketï¼ˆè€Œéé•·è¼ªè©¢ï¼‰ï¼š**
- âœ… çœŸæ­£çš„å³æ™‚é€šè¨Š
- âœ… æ¸›å°‘ä¼ºæœå™¨è² è¼‰
- âœ… æ›´å¥½çš„ç”¨æˆ¶é«”é©—

**TDD é–‹ç™¼æ–¹å¼ï¼š**
- âœ… æé«˜ç¨‹å¼ç¢¼å“è³ª
- âœ… é‡æ§‹æ›´å®‰å…¨
- âœ… æ–‡æª”åŒ–æ¸¬è©¦æ¡ˆä¾‹

---

**æ–‡æª”ç‰ˆæœ¬ï¼š** 2.7.0
**æœ€å¾Œæ›´æ–°ï¼š** 2025-12-25
**ç¶­è­·è€…ï¼š** MergeMeet Development Team

---

**Happy Coding!**
