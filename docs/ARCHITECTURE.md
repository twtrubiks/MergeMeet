# ğŸ—ï¸ MergeMeet æ¶æ§‹æ–‡æª”

## ğŸ“‹ æ–‡æª”ç›®çš„

æœ¬æ–‡æª”æ•´åˆå°ˆæ¡ˆçš„æ ¸å¿ƒæ¶æ§‹è¨­è¨ˆã€æŠ€è¡“é¸å‹ã€é–‹ç™¼ç­–ç•¥èˆ‡å¯¦ä½œé€²åº¦ï¼Œä½œç‚ºé–‹ç™¼åœ˜éšŠçš„æŠ€è¡“åƒè€ƒæŒ‡å—ã€‚

---

## 1. å°ˆæ¡ˆæ¦‚è¿°

### 1.1 å°ˆæ¡ˆå®šç¾©

```yaml
å°ˆæ¡ˆåç¨±: MergeMeet
å°ˆæ¡ˆé¡å‹: Web-based Dating Platform (ç¶²é ç‰ˆäº¤å‹å¹³å°)
ç›®æ¨™å¸‚å ´: å°ç£ï¼ˆåˆæœŸï¼‰
ç›®æ¨™ç”¨æˆ¶: 18æ­²ä»¥ä¸Šæˆå¹´äºº
é–‹ç™¼éšæ®µ: MVP (Minimum Viable Product)
ç•¶å‰ç‹€æ…‹: Week 1-6 å·²å®Œæˆ
```

### 1.2 å°ˆæ¡ˆç›®æ¨™

**ä¸»è¦ç›®æ¨™ï¼š**
- æä¾›å®‰å…¨ã€æœ‰è¶£çš„ç·šä¸Šäº¤å‹é«”é©—
- é€éèˆˆè¶£å’Œåœ°ç†ä½ç½®å¹«åŠ©ç”¨æˆ¶æ‰¾åˆ°åˆé©å°è±¡
- å»ºç«‹åŸºæ–¼é…å°çš„å³æ™‚èŠå¤©å¹³å°

**æŠ€è¡“ç›®æ¨™ï¼š**
- âœ… å»ºç«‹å¯æ“´å±•çš„æŠ€è¡“æ¶æ§‹
- âœ… é”åˆ° 80% ä»¥ä¸Šæ¸¬è©¦è¦†è“‹ç‡ï¼ˆå·²é”æˆï¼‰

---

## 2. ç³»çµ±æ¶æ§‹

### 2.1 æ•´é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ¶ç«¯ (Browser)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           Vue.js 3 Frontend                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  Views   â”‚  â”‚  Pinia   â”‚  â”‚  WebSocket   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚Componentsâ”‚  â”‚  Stores  â”‚  â”‚    Client    â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTPS / WSS
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FastAPI Backend                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  API Routes  â”‚  â”‚  Services   â”‚  â”‚  WebSocket   â”‚    â”‚
â”‚  â”‚              â”‚  â”‚             â”‚  â”‚   Manager    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                 â”‚                â”‚            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                    â–¼                                    â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚            â”‚  SQLAlchemy  â”‚                             â”‚
â”‚            â”‚   2.0 Async  â”‚                             â”‚
â”‚            â”‚     ORM      â”‚                             â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL   â”‚          â”‚    Redis     â”‚
â”‚ 17 + PostGIS  â”‚          â”‚     8.x      â”‚
â”‚               â”‚          â”‚              â”‚
â”‚  - Users      â”‚          â”‚  - Cache     â”‚
â”‚  - Profiles   â”‚          â”‚  - Sessions  â”‚
â”‚  - Matches    â”‚          â”‚  - ç™»å…¥é™åˆ¶   â”‚
â”‚  - Messages   â”‚          â”‚              â”‚
â”‚  - Reports    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€è¡“æ£§è©³ç´°èªªæ˜

#### å¾Œç«¯æŠ€è¡“æ£§

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” | ç‹€æ…‹ |
|------|------|------|------|
| **Python** | 3.12+ | ä¸»è¦é–‹ç™¼èªè¨€ | âœ… |
| **FastAPI** | 0.109+ | Web æ¡†æ¶ | âœ… |
| **SQLAlchemy** | 2.0 | ORMï¼ˆAsyncï¼‰ | âœ… |
| **PostgreSQL** | 17 | ä¸»è³‡æ–™åº« | âœ… |
| **PostGIS** | 3.5+ | åœ°ç†ä½ç½®æŸ¥è©¢ | âœ… |
| **Redis** | 8.x | å¿«å–/Session/ç™»å…¥é™åˆ¶ | ğŸ”„ éƒ¨åˆ†ä½¿ç”¨ |
| **Pydantic** | 2.5+ | è³‡æ–™é©—è­‰ | âœ… |
| **JWT** | python-jose | èªè­‰æ©Ÿåˆ¶ | âœ… |
| **aiosmtplib** | 3.0+ | Email ç™¼é€æœå‹™ | âœ… |
| **Mailpit** | latest | Email æ¸¬è©¦å·¥å…·ï¼ˆé–‹ç™¼ï¼‰ | âœ… |
| **Alembic** | 1.13+ | è³‡æ–™åº«é·ç§» | âœ… |
| **pytest** | 7.4+ | æ¸¬è©¦æ¡†æ¶ | âœ… |

#### å‰ç«¯æŠ€è¡“æ£§

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” | ç‹€æ…‹ |
|------|------|------|------|
| **Vue.js** | 3.x | å‰ç«¯æ¡†æ¶ | âœ… |
| **Vite** | 5.x | å»ºæ§‹å·¥å…· | âœ… |
| **Pinia** | 2.x | ç‹€æ…‹ç®¡ç† | âœ… |
| **Vue Router** | 4.x | è·¯ç”±ç®¡ç† | âœ… |
| **Axios** | 1.x | HTTP å®¢æˆ¶ç«¯ | âœ… |
| **WebSocket API** | åŸç”Ÿ | å³æ™‚é€šè¨Š | âœ… |

### 2.3 è³‡æ–™åº«æ¶æ§‹

#### è³‡æ–™æ¨¡å‹é—œä¿‚åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           User            â”‚  (ç”¨æˆ¶åŸºæœ¬è³‡æ–™)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                   â”‚
â”‚ email                     â”‚
â”‚ password_hash             â”‚
â”‚ email_verified            â”‚
â”‚ date_of_birth             â”‚
â”‚ trust_score               â”‚
â”‚ warning_count             â”‚
â”‚ is_active                 â”‚
â”‚ is_admin                  â”‚
â”‚ ban_reason                â”‚
â”‚ banned_until              â”‚
â”‚ password_reset_token      â”‚
â”‚ password_reset_expires    â”‚
â”‚ created_at                â”‚
â”‚ updated_at                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ 1:1
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Profile          â”‚  (å€‹äººæª”æ¡ˆ)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                   â”‚
â”‚ user_id (FK)              â”‚
â”‚ display_name              â”‚  â† é¡¯ç¤ºåç¨±
â”‚ bio                       â”‚
â”‚ gender                    â”‚
â”‚ location (PostGIS Point)  â”‚
â”‚ location_name             â”‚
â”‚ min_age_preference        â”‚
â”‚ max_age_preference        â”‚
â”‚ max_distance_km           â”‚
â”‚ gender_preference         â”‚
â”‚ is_complete               â”‚
â”‚ is_visible                â”‚
â”‚ last_active               â”‚
â”‚ created_at                â”‚
â”‚ updated_at                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ 1:N(ä¸€å°å¤š)                               â”‚ N:M (å¤šå°å¤š)
      â–¼                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Photo          â”‚     â”‚       InterestTag       â”‚  (èˆˆè¶£æ¨™ç±¤)
â”‚                         â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚ id (PK)                 â”‚
â”‚ id (PK)                 â”‚     â”‚ name                    â”‚
â”‚ profile_id (FK)         â”‚     â”‚ category                â”‚
â”‚ url                     â”‚     â”‚ icon                    â”‚
â”‚ thumbnail_url           â”‚     â”‚ is_active               â”‚
â”‚ is_profile_picture      â”‚     â”‚ created_at              â”‚
â”‚ display_order           â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ file_size               â”‚
â”‚ width                   â”‚
â”‚ height                  â”‚
â”‚ mime_type               â”‚
â”‚ moderation_status       â”‚  â† å¯©æ ¸ç‹€æ…‹ (pending/approved/rejected)
â”‚ rejection_reason        â”‚
â”‚ reviewed_by             â”‚
â”‚ reviewed_at             â”‚
â”‚ auto_moderation_score   â”‚
â”‚ auto_moderation_labels  â”‚
â”‚ created_at              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Like       â”‚     â”‚      Pass       â”‚     â”‚      Match      â”‚  (é…å°è¨˜éŒ„)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚
â”‚ from_user_id    â”‚     â”‚ from_user_id    â”‚     â”‚ user1_id        â”‚
â”‚ to_user_id      â”‚     â”‚ to_user_id      â”‚     â”‚ user2_id        â”‚
â”‚ created_at      â”‚     â”‚ passed_at       â”‚     â”‚ status          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ matched_at      â”‚
         â”‚                       â”‚              â”‚ unmatched_at    â”‚
         â”‚                       â”‚              â”‚ unmatched_by    â”‚
         â–¼                       â–¼              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   æ°¸ä¹…ä¸å†å‡ºç¾           24å°æ™‚å…§ä¸å‡ºç¾                     â”‚
   åœ¨æ¢ç´¢é               24å°æ™‚å¾Œé‡æ–°å‡ºç¾                    â”‚
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
                     â”‚                                   â”‚
                     â””â”€â”€â”€â”€â”€â”€ äº’ç›¸å–œæ­¡æ™‚å»ºç«‹ Match â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ 1:N (ä¸€å°å¤š)
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚       Message       â”‚  (èŠå¤©è¨Šæ¯)
                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                          â”‚ id (PK)             â”‚
                          â”‚ match_id (FK)       â”‚
                          â”‚ sender_id           â”‚
                          â”‚ content             â”‚
                          â”‚ message_type        â”‚  (TEXT/IMAGE/GIF)
                          â”‚ is_read (DateTime)  â”‚  â† è®€å–æ™‚é–“
                          â”‚ deleted_at          â”‚  (è»Ÿåˆªé™¤)
                          â”‚ sent_at             â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     BlockedUser     â”‚          â”‚        Report       â”‚  (èˆ‰å ±è¨˜éŒ„)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)             â”‚          â”‚ id (PK)             â”‚
â”‚ blocker_id          â”‚          â”‚ reporter_id         â”‚
â”‚ blocked_id          â”‚          â”‚ reported_user_id    â”‚
â”‚ reason              â”‚          â”‚ report_type         â”‚
â”‚ created_at          â”‚          â”‚ reason              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ evidence            â”‚
                                 â”‚ status              â”‚
                                 â”‚ admin_notes         â”‚  â† ç®¡ç†å“¡å‚™è¨»
                                 â”‚ reviewed_by         â”‚
                                 â”‚ reviewed_at         â”‚
                                 â”‚ created_at          â”‚
                                 â”‚ updated_at          â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Notification    â”‚  (é€šçŸ¥è¨˜éŒ„ - æŒä¹…åŒ–)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)             â”‚  â† WebSocket é€šçŸ¥åŒ…å«æ­¤ ID
â”‚ user_id             â”‚
â”‚ type                â”‚  (message/match/liked)
â”‚ title               â”‚
â”‚ content             â”‚
â”‚ data (JSONB)        â”‚
â”‚ is_read             â”‚  â† å‰ç«¯é€é API æ¨™è¨˜å·²è®€
â”‚ created_at          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

**WebSocket é€šçŸ¥ Payload**ï¼ˆæ‰€æœ‰é¡å‹éƒ½åŒ…å« `notification_id` ä¾›å‰ç«¯æ¨™è¨˜å·²è®€ï¼‰:

| é¡å‹                 | æ¬„ä½                                                    |
|----------------------|---------------------------------------------------------|
| notification_message | notification_id, match_id, sender_id, sender_name, preview, timestamp |
| notification_match   | notification_id, match_id, matched_user_id, matched_user_name, matched_user_avatar, timestamp |
| notification_liked   | notification_id, timestamp                              |


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SensitiveWord    â”‚   â”‚    ContentAppeal    â”‚   â”‚    ModerationLog    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)             â”‚   â”‚ id (PK)             â”‚   â”‚ id (PK)             â”‚
â”‚ word                â”‚   â”‚ user_id             â”‚   â”‚ user_id             â”‚
â”‚ category            â”‚   â”‚ appeal_type         â”‚   â”‚ content_type        â”‚
â”‚ severity            â”‚   â”‚ rejected_content    â”‚   â”‚ original_content    â”‚
â”‚ action              â”‚   â”‚ violations          â”‚   â”‚ is_approved         â”‚
â”‚ (WARN/REJECT/       â”‚   â”‚ reason              â”‚   â”‚ violations          â”‚
â”‚  AUTO_BAN)          â”‚   â”‚ status              â”‚   â”‚ triggered_word_ids  â”‚
â”‚ is_active           â”‚   â”‚ admin_response      â”‚   â”‚ action_taken        â”‚
â”‚ is_regex            â”‚   â”‚ reviewed_by         â”‚   â”‚ created_at          â”‚
â”‚ description         â”‚   â”‚ reviewed_at         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ created_by          â”‚   â”‚ created_at          â”‚
â”‚ created_at          â”‚   â”‚ updated_at          â”‚
â”‚ updated_at          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 PostGIS åœ°ç†ä½ç½®æŸ¥è©¢

#### ç‚ºä»€éº¼ä½¿ç”¨ PostGIS

MergeMeet ä½œç‚ºäº¤å‹å¹³å°ï¼Œ**åœ°ç†ä½ç½®æœç´¢æ˜¯æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ç”¨æˆ¶éœ€è¦æ‰¾åˆ°ã€Œé™„è¿‘çš„äººã€
- é…å°ç®—æ³•éœ€è¦è¨ˆç®—ç”¨æˆ¶é–“çš„å¯¦éš›è·é›¢
- è·é›¢æ˜¯é…å°è©•åˆ†çš„é‡è¦å› ç´ ï¼ˆä½” 20%ï¼‰

**æŠ€è¡“é¸å‹ç†ç”±**ï¼š

| æ–¹æ¡ˆ | å„ªé» | ç¼ºé» | çµè«– |
|------|------|------|------|
| **PostGIS** | ç²¾ç¢ºçƒé¢è¨ˆç®—ã€åŸç”Ÿ SQL æ”¯æ´ã€é«˜æ•ˆç©ºé–“ç´¢å¼• | éœ€è¦é¡å¤–æ“´å±• | âœ… æ¡ç”¨ |
| æ‡‰ç”¨å±¤è¨ˆç®— | ç°¡å–® | æ•ˆèƒ½å·®ã€ç„¡æ³•åˆ©ç”¨ç´¢å¼• | âŒ |
| Elasticsearch Geo | å…¨æ–‡æœç´¢æ•´åˆ | é¡å¤–ç¶­è­·æˆæœ¬ | âŒ |

#### Docker æ˜ åƒé¸æ“‡

```yaml
# docker-compose.yml
services:
  postgres:
    image: postgis/postgis:17-3.5
```

**ç‰ˆæœ¬èªªæ˜**ï¼š
- **PostgreSQL 17**ï¼š2024-09 ç™¼å¸ƒï¼Œæ•ˆèƒ½å„ªåŒ–ã€JSON_TABLE æ”¯æ´
- **PostGIS 3.5**ï¼š2024 å¹´ç™¼å¸ƒï¼Œæ”¯æ´æœ€æ–°ç©ºé–“å‡½æ•¸
- **å®˜æ–¹æ˜ åƒ**ï¼šç”± PostGIS åœ˜éšŠç¶­è­·ï¼Œé å…ˆå®‰è£æ“´å±•

#### è³‡æ–™é¡å‹é¸æ“‡

```python
# backend/app/models/profile.py
from geoalchemy2 import Geography

class Profile(Base):
    # ä½¿ç”¨ Geography é¡å‹ï¼ˆè€Œé Geometryï¼‰
    location = Column(Geography(geometry_type='POINT', srid=4326))
```

**Geography vs Geometry**ï¼š

| ç‰¹æ€§ | Geography | Geometry |
|------|-----------|----------|
| åº§æ¨™ç³»çµ± | çƒé¢ï¼ˆåœ°çƒè¡¨é¢ï¼‰ | å¹³é¢ï¼ˆç¬›å¡çˆ¾ï¼‰ |
| è·é›¢è¨ˆç®— | å…¬å°ºï¼ˆç²¾ç¢ºï¼‰ | åº§æ¨™å–®ä½ï¼ˆéœ€è½‰æ›ï¼‰ |
| é©ç”¨ç¯„åœ | å…¨çƒ | å°å€åŸŸï¼ˆåŸå¸‚ç´šï¼‰ |
| æ•ˆèƒ½ | ç¨æ…¢ | è¼ƒå¿« |
| **æœ¬å°ˆæ¡ˆé¸æ“‡** | âœ… æ¡ç”¨ | - |

**é¸æ“‡ Geography çš„åŸå› **ï¼š
- äº¤å‹å¹³å°ç”¨æˆ¶åˆ†å¸ƒå…¨å°ç£ï¼Œéœ€è¦ç²¾ç¢ºçš„çƒé¢è·é›¢
- `ST_Distance` ç›´æ¥è¿”å›å…¬å°ºï¼Œç„¡éœ€é¡å¤–è½‰æ›
- æœªä¾†æ“´å±•åˆ°å…¶ä»–åœ‹å®¶æ™‚ç„¡éœ€ä¿®æ”¹

#### ä½¿ç”¨çš„ PostGIS å‡½æ•¸

| å‡½æ•¸ | ç”¨é€” | ä½¿ç”¨ä½ç½® |
|------|------|----------|
| `ST_MakePoint(lng, lat)` | å¾ç¶“ç·¯åº¦å‰µå»ºé» | å‰µå»º/æ›´æ–°å€‹äººæª”æ¡ˆ |
| `ST_SetSRID(..., 4326)` | è¨­å®šåº§æ¨™ç³»çµ± | å‰µå»º/æ›´æ–°å€‹äººæª”æ¡ˆ |
| `ST_Distance(a, b, true)` | è¨ˆç®—çƒé¢è·é›¢ï¼ˆå…¬å°ºï¼‰ | é…å°ç®—æ³•è·é›¢è©•åˆ† |
| `ST_DWithin(a, b, dist, true)` | ç¯„åœå…§ç¯©é¸ | æ¢ç´¢åŠŸèƒ½è·é›¢éæ¿¾ |

**ä»£ç¢¼ç¯„ä¾‹**ï¼š

```python
# 1. å‰µå»ºä½ç½®é»ï¼ˆcreate_profile å‡½æ•¸ï¼‰
from geoalchemy2.functions import ST_MakePoint, ST_SetSRID

profile.location = ST_SetSRID(
    ST_MakePoint(longitude, latitude),  # æ³¨æ„ï¼šç¶“åº¦åœ¨å‰
    4326
)

# 2. è¨ˆç®—è·é›¢ï¼ˆget_discovery_candidates å‡½æ•¸ï¼‰
from sqlalchemy import func

distance_km = (
    func.ST_Distance(
        Profile.location,
        my_profile.location,
        True  # use_spheroid=True
    ) / 1000
).label('distance_km')

# 3. ç¯„åœç¯©é¸ï¼ˆget_discovery_candidates å‡½æ•¸ï¼‰
from geoalchemy2.functions import ST_DWithin

ST_DWithin(
    Profile.location,
    my_profile.location,
    max_distance_km * 1000,  # å…¬é‡Œè½‰å…¬å°º
    True
)
```

#### æ•ˆèƒ½å„ªåŒ–

- ä½¿ç”¨ `ST_DWithin` è€Œé `ST_Distance < X`ï¼ˆå¯åˆ©ç”¨ GIST ç´¢å¼•ï¼‰
- è·é›¢è¨ˆç®—ä½œç‚º SELECT æ¬„ä½ï¼Œé¿å…äºŒæ¬¡æŸ¥è©¢
- `selectinload` é è¼‰å…¥é—œè¯è³‡æ–™

#### ORM æ•´åˆï¼ˆGeoAlchemy2ï¼‰

```txt
# backend/requirements.txt
geoalchemy2==0.14.3
```

**GeoAlchemy2 åŠŸèƒ½**ï¼š
- SQLAlchemy 2.0 Async æ”¯æ´
- è‡ªå‹•é¡å‹è½‰æ›ï¼ˆWKB â†” Pythonï¼‰
- PostGIS å‡½æ•¸æ˜ å°„ï¼ˆ`ST_*` â†’ Python å‡½æ•¸ï¼‰

#### æ¸¬è©¦é…ç½®

```python
# backend/tests/conftest.py
async with engine.begin() as conn:
    # æ¸¬è©¦è³‡æ–™åº«éœ€è¦å•Ÿç”¨ PostGIS æ“´å±•
    await conn.execute(text("CREATE EXTENSION IF NOT EXISTS postgis"))
```

#### å¸¸è¦‹å•é¡Œæ’é™¤

**éŒ¯èª¤ 1**ï¼š`function st_distance does not exist`
```bash
# è§£æ±ºæ–¹æ¡ˆï¼šå•Ÿç”¨ PostGIS æ“´å±•
docker exec mergemeet_postgres psql -U mergemeet -d mergemeet \
  -c "CREATE EXTENSION IF NOT EXISTS postgis;"
```

**éŒ¯èª¤ 2**ï¼šè·é›¢è¨ˆç®—çµæœç‚º `None`
```python
# åŸå› ï¼šç”¨æˆ¶æœªè¨­å®šä½ç½®
# è§£æ±ºï¼šæª¢æŸ¥ location æ˜¯å¦ç‚ºç©º
if profile.location is None:
    distance_km = None
```

#### ç›¸é—œæ–‡ä»¶

| æ–‡ä»¶ | èªªæ˜ |
|------|------|
| `backend/app/models/profile.py` | Profile æ¨¡å‹å®šç¾©ï¼ˆlocation æ¬„ä½ï¼‰ |
| `backend/app/api/profile.py` | ä½ç½®è¨­å®š API |
| `backend/app/api/discovery.py` | è·é›¢æœç´¢é‚è¼¯ |
| `docs/MATCHING_ALGORITHM.md` | é…å°ç®—æ³•ï¼ˆè·é›¢è©•åˆ†ï¼‰ |

---

## 3. åŠŸèƒ½èˆ‡è·¯ç·šåœ–

> åŠŸèƒ½æ¸…å–®å’Œé–‹ç™¼è·¯ç·šåœ–å·²ç¨ç«‹ç¶­è­·ï¼Œé¿å…é‡è¤‡ï¼š

| æ–‡æª” | èªªæ˜ |
|------|------|
| **[FEATURES.md](FEATURES.md)** | å·²å®ŒæˆåŠŸèƒ½æ¸…å–®ï¼ˆWeek 1-6 è©³ç´°èªªæ˜ï¼‰ |
| **[ROADMAP.md](ROADMAP.md)** | æŠ€è¡“è·¯ç·šåœ–ï¼ˆæœªä¾†é–‹ç™¼è¦åŠƒï¼‰ |

---

## 4. é–‹ç™¼ç­–ç•¥

> è©³è¦‹ **Skill: mergemeet-quickstart** çš„ [workflows.md](../.claude/skills/mergemeet-quickstart/references/workflows.md)

åŒ…å«ï¼š
- Git å·¥ä½œæµç¨‹èˆ‡åˆ†æ”¯ç­–ç•¥
- Conventional Commits è¦ç¯„
- TDD æ¸¬è©¦æµç¨‹ï¼ˆè¦†è“‹ç‡ >80%ï¼‰
- CI/CD èˆ‡ç™¼å¸ƒæµç¨‹

ç¨‹å¼ç¢¼è¦ç¯„è©³è¦‹ Skillsï¼š**[backend-dev-fastapi](../.claude/skills/backend-dev-fastapi/SKILL.md)**ã€**[frontend-dev-vue3](../.claude/skills/frontend-dev-vue3/SKILL.md)**

---

## 5. API ç«¯é»

> å®Œæ•´ API æ–‡æª”è«‹åƒé–±ï¼šhttp://localhost:8000/docs

---

## 6. å‰ç«¯æ¶æ§‹

| ç›®éŒ„ | èªªæ˜ |
|------|------|
| `src/views/` | é é¢çµ„ä»¶ |
| `src/components/` | å…±ç”¨çµ„ä»¶ |
| `src/stores/` | Pinia ç‹€æ…‹ç®¡ç† |
| `src/composables/` | Vue Composables |
| `src/api/` | API å®¢æˆ¶ç«¯ |
| `src/router/` | è·¯ç”±é…ç½® |

---

## 7. æ¸¬è©¦æ¶æ§‹

### 7.1 æ¸¬è©¦æ¦‚æ³

| é …ç›® | èªªæ˜ |
|------|------|
| æ¸¬è©¦æª”æ¡ˆä½ç½® | `backend/tests/` |
| æ¸¬è©¦æ¡ˆä¾‹æ•¸ | è©³è¦‹ `pytest --collect-only` |
| è¦†è“‹ç‡ç›®æ¨™ | >80% |
| æ¸¬è©¦æ¡†æ¶ | pytest + pytest-asyncio |

> æœ€æ–°æ¸¬è©¦çµ±è¨ˆè«‹åƒè€ƒ [README.md](../README.md#-æ¸¬è©¦) æˆ–åŸ·è¡Œ `pytest -v --cov=app`

### 7.2 æ¸¬è©¦å·¥å…·

```python
# pytest é…ç½®
[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
asyncio_mode = "auto"

# æ¸¬è©¦å‘½ä»¤
pytest -v                    # è©³ç´°è¼¸å‡º
pytest --cov=app            # æ¸¬è©¦è¦†è“‹ç‡
pytest tests/test_safety.py # ç‰¹å®šæª”æ¡ˆ
pytest -m unit              # ç‰¹å®šæ¨™è¨˜
```

---

## 8. å®‰å…¨æªæ–½

> è©³ç´°å®‰å…¨ç­–ç•¥è«‹åƒè€ƒ **[SECURITY.md](SECURITY.md)**

**å·²å¯¦ä½œçš„å®‰å…¨æ©Ÿåˆ¶ï¼š**
- HttpOnly Cookie + CSRF é˜²è­·
- JWT èªè­‰ï¼ˆAccess + Refresh Tokenï¼‰
- å¯†ç¢¼é›œæ¹Šï¼ˆbcrypt + SHA256 é è™•ç†ï¼‰
- SQL æ³¨å…¥é˜²è­·ï¼ˆSQLAlchemy ORMï¼‰
- XSS é˜²è­·ï¼ˆè¼¸å…¥é©—è­‰ + è¼¸å‡ºç·¨ç¢¼ï¼‰
- WebSocket Token é©—è­‰ + ç•°å¸¸é€£æ¥æ¸…ç†
- ç™»å…¥å¤±æ•—é™åˆ¶ï¼ˆRedisï¼Œ5 æ¬¡/15 åˆ†é˜ï¼‰
- ä¿¡ä»»åˆ†æ•¸ç³»çµ±ï¼ˆè‡ªå‹•è¡Œç‚ºç›£æ§ï¼‰
- å…§å®¹å¯©æ ¸ç³»çµ±ï¼ˆæ•æ„Ÿè©éæ¿¾ï¼‰

---

## 9. é—œéµæ±ºç­–è¨˜éŒ„

### 9.1 æŠ€è¡“é¸å‹

**é¸æ“‡ FastAPIï¼ˆè€Œé Djangoï¼‰ï¼š**
- âœ… åŸç”Ÿæ”¯æ´ Async/Await
- âœ… è‡ªå‹•ç”Ÿæˆ API æ–‡æª”
- âœ… å„ªç§€çš„æ•ˆèƒ½è¡¨ç¾
- âœ… ç¾ä»£åŒ–çš„é–‹ç™¼é«”é©—

**é¸æ“‡ Vue 3ï¼ˆè€Œé Reactï¼‰ï¼š**
- âœ… Composition API æ›´ç›´è¦º
- âœ… è¼•é‡ç´šæ¡†æ¶
- âœ… å„ªç§€çš„ä¸­æ–‡æ–‡æª”
- âœ… å­¸ç¿’æ›²ç·šè¼ƒå¹³ç·©

**é¸æ“‡ PostgreSQL + PostGISï¼š**
- âœ… å¼·å¤§çš„åœ°ç†ä½ç½®æŸ¥è©¢
- âœ… JSONB æ”¯æ´
- âœ… å®Œå–„çš„é—œè¯å¼è³‡æ–™åº«
- âœ… å…è²»é–‹æº

### 9.2 æ¶æ§‹æ±ºç­–

**æ¡ç”¨å‰å¾Œç«¯åˆ†é›¢ï¼š**
- âœ… å‰å¾Œç«¯ç¨ç«‹é–‹ç™¼
- âœ… æ›´å¥½çš„å¯æ“´å±•æ€§
- âœ… æ”¯æ´å¤šç«¯ï¼ˆWebã€Mobileï¼‰

**ä½¿ç”¨ WebSocketï¼ˆè€Œéé•·è¼ªè©¢ï¼‰ï¼š**
- âœ… çœŸæ­£çš„å³æ™‚é€šè¨Š
- âœ… æ¸›å°‘ä¼ºæœå™¨è² è¼‰
- âœ… æ›´å¥½çš„ç”¨æˆ¶é«”é©—

**TDD é–‹ç™¼æ–¹å¼ï¼š**
- âœ… æé«˜ç¨‹å¼ç¢¼å“è³ª
- âœ… é‡æ§‹æ›´å®‰å…¨
- âœ… æ–‡æª”åŒ–æ¸¬è©¦æ¡ˆä¾‹

---

**æ–‡æª”ç‰ˆæœ¬ï¼š** 2.8.0
**æœ€å¾Œæ›´æ–°ï¼š** 2025-12-26
**ç¶­è­·è€…ï¼š** MergeMeet Development Team

---

**Happy Coding!**
